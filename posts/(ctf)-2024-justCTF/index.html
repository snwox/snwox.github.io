<!DOCTYPE html><html lang="kr" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="(CTF) justCTF 2024 writeup (Blockchains)" /><meta property="og:locale" content="kr" /><meta name="description" content="MOVE language newbie’s writeup" /><meta property="og:description" content="MOVE language newbie’s writeup" /><link rel="canonical" href="http://blog.solidity.kr/posts/(ctf)-2024-justCTF/" /><meta property="og:url" content="http://blog.solidity.kr/posts/(ctf)-2024-justCTF/" /><meta property="og:site_name" content="snwo" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-06-16T17:02:13+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="(CTF) justCTF 2024 writeup (Blockchains)" /><meta name="twitter:site" content="@snwo_kr" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"MOVE language newbie’s writeup","url":"http://blog.solidity.kr/posts/(ctf)-2024-justCTF/","@type":"BlogPosting","headline":"(CTF) justCTF 2024 writeup (Blockchains)","dateModified":"2024-06-16T21:56:11+09:00","datePublished":"2024-06-16T17:02:13+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.solidity.kr/posts/(ctf)-2024-justCTF/"},"@context":"https://schema.org"}</script><title>(CTF) justCTF 2024 writeup (Blockchains) | snwo</title><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://media.discordapp.net/attachments/952583628351746111/1366448241180409956/ralph.png?ex=68f9ac58&is=68f85ad8&hm=fa5cd570119d286902631feb85f361030c6a4f7c3eb252f258530ed92ba7ba4b&=&format=webp&quality=lossless&width=2488&height=2168" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">snwo</a></div><div class="site-subtitle font-italic">Interested in REV,WEB3,PWN</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/snwox" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/snwo_kr" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>(CTF) justCTF 2024 writeup (Blockchains)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>(CTF) justCTF 2024 writeup (Blockchains)</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/snwo_kr">snwo</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2024-06-16 17:02:13 +0900" data-toggle="tooltip" data-placement="bottom" title="Sun, Jun 16, 2024, 5:02 PM +0900" >Jun 16, 2024</em> </span> <span> Updated <em class="timeago" date="2024-06-16 21:56:11 +0900 " data-toggle="tooltip" data-placement="bottom" title="Sun, Jun 16, 2024, 9:56 PM +0900" >Jun 16, 2024</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3155 words"> <em>17 min</em> read</span></div></div></div><div class="post-content"><p><img data-src="/assets/img/2024-06-16-justCTF/img1.png" alt="img1.png" data-proofer-ignore> It was first time for me to solve move based challenge. Solved 3 blockchain challenges, <code class="language-plaintext highlighter-rouge">World of Ottercraft</code>, <code class="language-plaintext highlighter-rouge">The Otter Scrolls</code>, <code class="language-plaintext highlighter-rouge">Dark BrOTTERhood</code> ( all move based challenge )</p><h2 id="the-otter-scrolls">The Otter Scrolls<a href="#the-otter-scrolls" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>All the challenges use the <a href="https://github.com/otter-sec/sui-ctf-framework">Sui CTF Framework</a>. Like solana challenges, we should send out compiled contract to the server.</p><p><code class="language-plaintext highlighter-rouge">framework/src/main.rs</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre><td class="rouge-code"><pre>    <span class="c1">// Publish Challenge Module</span>
    <span class="k">let</span> <span class="n">chall_dependencies</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
    <span class="k">let</span> <span class="n">chall_addr</span> <span class="o">=</span> <span class="nn">sui_ctf_framework</span><span class="p">::</span><span class="nf">publish_compiled_module</span><span class="p">(</span>
        <span class="o">&amp;</span><span class="k">mut</span> <span class="n">adapter</span><span class="p">,</span>
        <span class="n">mncp_modules</span><span class="p">,</span>
        <span class="n">chall_dependencies</span><span class="p">,</span>
        <span class="nf">Some</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"challenger"</span><span class="p">)),</span>
    <span class="p">)</span><span class="k">.await</span><span class="p">;</span>
    <span class="n">deployed_modules</span><span class="nf">.push</span><span class="p">(</span><span class="n">chall_addr</span><span class="p">);</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"[SERVER] Module published at: {:?}"</span><span class="p">,</span> <span class="n">chall_addr</span><span class="p">);</span> 

    <span class="k">let</span> <span class="k">mut</span> <span class="n">solution_data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">as</span> <span class="nb">u8</span><span class="p">;</span> <span class="mi">2000</span><span class="p">];</span>
    <span class="k">let</span> <span class="n">_solution_size</span> <span class="o">=</span> <span class="n">stream</span><span class="nf">.read</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">solution_data</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

    <span class="c1">// Send Challenge Address</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">output</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
    <span class="nn">fmt</span><span class="p">::</span><span class="nf">write</span><span class="p">(</span>
        <span class="o">&amp;</span><span class="k">mut</span> <span class="n">output</span><span class="p">,</span>
        <span class="nd">format_args!</span><span class="p">(</span>
            <span class="s">"[SERVER] Challenge modules published at: {}"</span><span class="p">,</span>
            <span class="n">chall_addr</span><span class="nf">.to_string</span><span class="p">()</span><span class="nf">.as_str</span><span class="p">(),</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="nf">.unwrap</span><span class="p">();</span>
    <span class="n">stream</span><span class="nf">.write</span><span class="p">(</span><span class="n">output</span><span class="nf">.as_bytes</span><span class="p">())</span><span class="nf">.unwrap</span><span class="p">();</span>
<span class="o">...</span>
    <span class="c1">// Publish Solution Module</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">sol_dependencies</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
    <span class="n">sol_dependencies</span><span class="nf">.push</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"challenge"</span><span class="p">));</span>

    <span class="k">let</span> <span class="k">mut</span> <span class="n">mncp_solution</span> <span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">MaybeNamedCompiledModule</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
    <span class="k">let</span> <span class="n">module</span><span class="p">:</span> <span class="n">CompiledModule</span> <span class="o">=</span> <span class="k">match</span> <span class="nn">CompiledModule</span><span class="p">::</span><span class="nf">deserialize_with_defaults</span><span class="p">(</span><span class="o">&amp;</span><span class="n">solution_data</span><span class="nf">.to_vec</span><span class="p">())</span> <span class="p">{</span>
        <span class="nf">Ok</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="n">data</span><span class="p">,</span>
        <span class="nf">Err</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">_</span> <span class="o">=</span> <span class="n">adapter</span><span class="nf">.cleanup_resources</span><span class="p">()</span><span class="k">.await</span><span class="p">;</span>
            <span class="k">return</span> <span class="nf">Err</span><span class="p">(</span><span class="nn">Box</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="p">}</span>
    <span class="p">};</span> 
<span class="o">...</span>
    <span class="k">let</span> <span class="n">sol_addr</span> <span class="o">=</span> <span class="nn">sui_ctf_framework</span><span class="p">::</span><span class="nf">publish_compiled_module</span><span class="p">(</span>
        <span class="o">&amp;</span><span class="k">mut</span> <span class="n">adapter</span><span class="p">,</span>
        <span class="n">mncp_solution</span><span class="p">,</span>
        <span class="n">sol_dependencies</span><span class="p">,</span>
        <span class="nf">Some</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"solver"</span><span class="p">)),</span>
    <span class="p">)</span><span class="k">.await</span><span class="p">;</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"[SERVER] Solution published at: {:?}"</span><span class="p">,</span> <span class="n">sol_addr</span><span class="p">);</span>

</pre></table></code></div></div><p>In <code class="language-plaintext highlighter-rouge">main.rs</code>, It publishes challenge module and read bytecode, then publishes out solver module.</p><p><code class="language-plaintext highlighter-rouge">framework/src/main.rs</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre><td class="rouge-code"><pre>    <span class="c1">// Prepare Function Call Arguments</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">args_solve</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">SuiValue</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
    <span class="k">let</span> <span class="n">spellbook</span> <span class="o">=</span> <span class="nn">SuiValue</span><span class="p">::</span><span class="nf">Object</span><span class="p">(</span><span class="nn">FakeID</span><span class="p">::</span><span class="nf">Enumerated</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nb">None</span><span class="p">);</span> 
    <span class="n">args_solve</span><span class="nf">.push</span><span class="p">(</span><span class="n">spellbook</span><span class="nf">.clone</span><span class="p">());</span>

    <span class="k">let</span> <span class="n">type_args_solve</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">TypeTag</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>

    <span class="c1">// Call solve Function</span>
    <span class="k">let</span> <span class="n">ret_val</span> <span class="o">=</span> <span class="k">match</span> <span class="nn">sui_ctf_framework</span><span class="p">::</span><span class="nf">call_function</span><span class="p">(</span>
        <span class="o">&amp;</span><span class="k">mut</span> <span class="n">adapter</span><span class="p">,</span>
        <span class="n">sol_addr</span><span class="p">,</span>
        <span class="s">"solve"</span><span class="p">,</span>
        <span class="s">"solve"</span><span class="p">,</span>
        <span class="n">args_solve</span><span class="p">,</span>
        <span class="n">type_args_solve</span><span class="p">,</span>
        <span class="nf">Some</span><span class="p">(</span><span class="s">"solver"</span><span class="nf">.to_string</span><span class="p">()),</span>
    <span class="p">)</span><span class="k">.await</span> <span class="p">{</span>
        <span class="nf">Ok</span><span class="p">(</span><span class="n">output</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="n">output</span><span class="p">,</span>
        <span class="nf">Err</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">_</span> <span class="o">=</span> <span class="n">adapter</span><span class="nf">.cleanup_resources</span><span class="p">()</span><span class="k">.await</span><span class="p">;</span>
            <span class="nd">println!</span><span class="p">(</span><span class="s">"[SERVER] error: {e}"</span><span class="p">);</span>
            <span class="k">return</span> <span class="nf">Err</span><span class="p">(</span><span class="s">"error during call to solve::solve"</span><span class="nf">.into</span><span class="p">())</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="c1">// Check Solution</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">args_check</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">SuiValue</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
    <span class="n">args_check</span><span class="nf">.push</span><span class="p">(</span><span class="n">spellbook</span><span class="nf">.clone</span><span class="p">());</span>
    <span class="k">let</span> <span class="n">type_args_check</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">TypeTag</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>

    <span class="k">let</span> <span class="n">sol_ret</span> <span class="o">=</span> <span class="nn">sui_ctf_framework</span><span class="p">::</span><span class="nf">call_function</span><span class="p">(</span>
        <span class="o">&amp;</span><span class="k">mut</span> <span class="n">adapter</span><span class="p">,</span>
        <span class="n">chall_addr</span><span class="p">,</span>
        <span class="s">"theotterscrolls"</span><span class="p">,</span>
        <span class="s">"check_if_spell_casted"</span><span class="p">,</span>
        <span class="n">args_check</span><span class="p">,</span>
        <span class="n">type_args_check</span><span class="p">,</span>
        <span class="nf">Some</span><span class="p">(</span><span class="s">"solver"</span><span class="nf">.to_string</span><span class="p">()),</span>
    <span class="p">)</span><span class="k">.await</span><span class="p">;</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"[SERVER] Return value {:#?}"</span><span class="p">,</span> <span class="n">sol_ret</span><span class="p">);</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>

    <span class="c1">// Validate Solution</span>
    <span class="k">match</span> <span class="n">sol_ret</span> <span class="p">{</span>
        <span class="nf">Ok</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
            <span class="nd">println!</span><span class="p">(</span><span class="s">"[SERVER] Correct Solution!"</span><span class="p">);</span>
            <span class="nd">println!</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span> <span class="o">=</span> <span class="nn">env</span><span class="p">::</span><span class="nf">var</span><span class="p">(</span><span class="s">"FLAG"</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">let</span> <span class="n">message</span> <span class="o">=</span> <span class="nd">format!</span><span class="p">(</span><span class="s">"[SERVER] Congrats, flag: {}"</span><span class="p">,</span> <span class="n">flag</span><span class="p">);</span>
</pre></table></code></div></div><p>And, the server calls the <code class="language-plaintext highlighter-rouge">solve</code> function with the <code class="language-plaintext highlighter-rouge">spellbook</code> object and calls <code class="language-plaintext highlighter-rouge">check_if_spell_casted</code> function to check if it was solved.</p><p><code class="language-plaintext highlighter-rouge">framework/chall/sources/the_otter_scrolls.move</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
</pre><td class="rouge-code"><pre>    <span class="n">fun</span> <span class="nf">init</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">TxContext</span><span class="p">)</span> <span class="p">{</span>
        
        <span class="k">let</span> <span class="k">mut</span> <span class="n">all_words</span> <span class="o">=</span> <span class="nn">table</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>

        <span class="k">let</span> <span class="n">fire</span> <span class="o">=</span> <span class="n">vector</span><span class="p">[</span>
            <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Blast"</span><span class="p">),</span>
            <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Inferno"</span><span class="p">),</span>
            <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Pyre"</span><span class="p">),</span>
            <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Fenix"</span><span class="p">),</span>
            <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Ember"</span><span class="p">)</span>
        <span class="p">];</span>

        <span class="k">let</span> <span class="n">wind</span> <span class="o">=</span> <span class="n">vector</span><span class="p">[</span>
            <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Zephyr"</span><span class="p">),</span>
            <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Swirl"</span><span class="p">),</span>
            <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Breeze"</span><span class="p">),</span>
            <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Gust"</span><span class="p">),</span>
            <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Sigil"</span><span class="p">)</span>
        <span class="p">];</span>

        <span class="k">let</span> <span class="n">water</span> <span class="o">=</span> <span class="n">vector</span><span class="p">[</span>
            <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Aquarius"</span><span class="p">),</span>
            <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Mistwalker"</span><span class="p">),</span>
            <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Waves"</span><span class="p">),</span>
            <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Call"</span><span class="p">),</span>
            <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Storm"</span><span class="p">)</span>
        <span class="p">];</span>

        <span class="k">let</span> <span class="n">earth</span> <span class="o">=</span> <span class="n">vector</span><span class="p">[</span>
            <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Tremor"</span><span class="p">),</span>
            <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Stoneheart"</span><span class="p">),</span>
            <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Grip"</span><span class="p">),</span>
            <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Granite"</span><span class="p">),</span>
            <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Mudslide"</span><span class="p">)</span>
        <span class="p">];</span>

        <span class="k">let</span> <span class="n">power</span> <span class="o">=</span> <span class="n">vector</span><span class="p">[</span>
            <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Alakazam"</span><span class="p">),</span>
            <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Hocus"</span><span class="p">),</span>
            <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Pocus"</span><span class="p">),</span>
            <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Wazzup"</span><span class="p">),</span>
            <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Wrath"</span><span class="p">)</span>
        <span class="p">];</span>

        <span class="nn">table</span><span class="p">::</span><span class="nf">add</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">all_words</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fire</span><span class="p">);</span> 
        <span class="nn">table</span><span class="p">::</span><span class="nf">add</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">all_words</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wind</span><span class="p">);</span> 
        <span class="nn">table</span><span class="p">::</span><span class="nf">add</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">all_words</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">water</span><span class="p">);</span> 
        <span class="nn">table</span><span class="p">::</span><span class="nf">add</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">all_words</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">earth</span><span class="p">);</span> 
        <span class="nn">table</span><span class="p">::</span><span class="nf">add</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">all_words</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">power</span><span class="p">);</span> 

        <span class="k">let</span> <span class="n">spellbook</span> <span class="o">=</span> <span class="n">Spellbook</span> <span class="p">{</span>
            <span class="n">id</span><span class="p">:</span> <span class="nn">object</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="n">ctx</span><span class="p">),</span>
            <span class="n">casted</span><span class="p">:</span> <span class="k">false</span><span class="p">,</span>
            <span class="n">spells</span><span class="p">:</span> <span class="n">all_words</span>
        <span class="p">};</span>

        <span class="nn">transfer</span><span class="p">::</span><span class="nf">share_object</span><span class="p">(</span><span class="n">spellbook</span><span class="p">);</span>
    <span class="p">}</span>
</pre></table></code></div></div><p>In <code class="language-plaintext highlighter-rouge">init</code> function (same as constructor in solidity), it makes a spellbook vector and uses it as an argument of <code class="language-plaintext highlighter-rouge">transfer::share_object</code>. Then we can use this object to access spellbook.</p><p><code class="language-plaintext highlighter-rouge">framework/chall/sources/the_otter_scrolls.move</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre>    <span class="n">public</span> <span class="n">fun</span> <span class="nf">cast_spell</span><span class="p">(</span><span class="n">spell_sequence</span><span class="p">:</span> <span class="n">vector</span><span class="o">&lt;</span><span class="nb">u64</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">book</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Spellbook</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">let</span> <span class="n">fire</span> <span class="o">=</span> <span class="nn">table</span><span class="p">::</span><span class="nf">remove</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">book</span><span class="py">.spells</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">wind</span> <span class="o">=</span> <span class="nn">table</span><span class="p">::</span><span class="nf">remove</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">book</span><span class="py">.spells</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">water</span> <span class="o">=</span> <span class="nn">table</span><span class="p">::</span><span class="nf">remove</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">book</span><span class="py">.spells</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">earth</span> <span class="o">=</span> <span class="nn">table</span><span class="p">::</span><span class="nf">remove</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">book</span><span class="py">.spells</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">power</span> <span class="o">=</span> <span class="nn">table</span><span class="p">::</span><span class="nf">remove</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">book</span><span class="py">.spells</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

        <span class="k">let</span> <span class="n">fire_word_id</span> <span class="o">=</span> <span class="o">*</span><span class="nn">vector</span><span class="p">::</span><span class="nf">borrow</span><span class="p">(</span><span class="o">&amp;</span><span class="n">spell_sequence</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">wind_word_id</span> <span class="o">=</span> <span class="o">*</span><span class="nn">vector</span><span class="p">::</span><span class="nf">borrow</span><span class="p">(</span><span class="o">&amp;</span><span class="n">spell_sequence</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">water_word_id</span> <span class="o">=</span> <span class="o">*</span><span class="nn">vector</span><span class="p">::</span><span class="nf">borrow</span><span class="p">(</span><span class="o">&amp;</span><span class="n">spell_sequence</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">earth_word_id</span> <span class="o">=</span> <span class="o">*</span><span class="nn">vector</span><span class="p">::</span><span class="nf">borrow</span><span class="p">(</span><span class="o">&amp;</span><span class="n">spell_sequence</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">power_word_id</span> <span class="o">=</span> <span class="o">*</span><span class="nn">vector</span><span class="p">::</span><span class="nf">borrow</span><span class="p">(</span><span class="o">&amp;</span><span class="n">spell_sequence</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

        <span class="k">let</span> <span class="n">fire_word</span> <span class="o">=</span> <span class="nn">vector</span><span class="p">::</span><span class="nf">borrow</span><span class="p">(</span><span class="o">&amp;</span><span class="n">fire</span><span class="p">,</span> <span class="n">fire_word_id</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">wind_word</span> <span class="o">=</span> <span class="nn">vector</span><span class="p">::</span><span class="nf">borrow</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wind</span><span class="p">,</span> <span class="n">wind_word_id</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">water_word</span> <span class="o">=</span> <span class="nn">vector</span><span class="p">::</span><span class="nf">borrow</span><span class="p">(</span><span class="o">&amp;</span><span class="n">water</span><span class="p">,</span> <span class="n">water_word_id</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">earth_word</span> <span class="o">=</span> <span class="nn">vector</span><span class="p">::</span><span class="nf">borrow</span><span class="p">(</span><span class="o">&amp;</span><span class="n">earth</span><span class="p">,</span> <span class="n">earth_word_id</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">power_word</span> <span class="o">=</span> <span class="nn">vector</span><span class="p">::</span><span class="nf">borrow</span><span class="p">(</span><span class="o">&amp;</span><span class="n">power</span><span class="p">,</span> <span class="n">power_word_id</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">fire_word</span> <span class="o">==</span> <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Inferno"</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">wind_word</span> <span class="o">==</span> <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Zephyr"</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">water_word</span> <span class="o">==</span> <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Call"</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">earth_word</span> <span class="o">==</span> <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Granite"</span><span class="p">))</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">power_word</span> <span class="o">==</span> <span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"Wazzup"</span><span class="p">))</span> <span class="p">{</span>
                            <span class="n">book</span><span class="py">.casted</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
  
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">fun</span> <span class="nf">check_if_spell_casted</span><span class="p">(</span><span class="n">book</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">Spellbook</span><span class="p">):</span> <span class="nb">bool</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">casted</span> <span class="o">=</span> <span class="n">book</span><span class="py">.casted</span><span class="p">;</span>
        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="n">casted</span> <span class="o">==</span> <span class="k">true</span><span class="p">,</span> <span class="mi">1337</span><span class="p">);</span>
        <span class="n">casted</span>
    <span class="p">}</span>
</pre></table></code></div></div><p>In <code class="language-plaintext highlighter-rouge">cast_spell</code> function, It gets each index of the spellbook and checks it against some words. If all indexes are correct, set <code class="language-plaintext highlighter-rouge">book.casted=true</code>. The correct indexes are 1 (Inferno), 0 (Zephyr), 3 (Call), 3 (Granite), 3 (Wazzup).</p><p><code class="language-plaintext highlighter-rouge">framework-solve/solve/sources/solve.move</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="n">module</span> <span class="nn">solve</span><span class="p">::</span><span class="n">solve</span> <span class="p">{</span>

    <span class="c1">// [*] Import dependencies</span>
    <span class="k">use</span> <span class="nn">challenge</span><span class="p">::</span><span class="n">theotterscrolls</span><span class="p">;</span>
    <span class="k">use</span> <span class="nn">sui</span><span class="p">::</span><span class="nn">tx_context</span><span class="p">::{</span><span class="k">Self</span><span class="p">,</span> <span class="n">TxContext</span><span class="p">};</span>

    <span class="n">public</span> <span class="n">fun</span> <span class="nf">solve</span><span class="p">(</span>
        <span class="n">_spellbook</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nn">theotterscrolls</span><span class="p">::</span><span class="n">Spellbook</span><span class="p">,</span>
        <span class="n">_ctx</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">TxContext</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">spell_sequence</span> <span class="o">=</span> <span class="n">vector</span><span class="p">[</span>
            <span class="mi">1</span><span class="p">,</span> <span class="c1">// Inferno</span>
            <span class="mi">0</span><span class="p">,</span> <span class="c1">// Zephyr</span>
            <span class="mi">3</span><span class="p">,</span> <span class="c1">// Call</span>
            <span class="mi">3</span><span class="p">,</span> <span class="c1">// Granite</span>
            <span class="mi">3</span>  <span class="c1">// Wazzup</span>
        <span class="p">];</span>
        <span class="nn">theotterscrolls</span><span class="p">::</span><span class="nf">cast_spell</span><span class="p">(</span><span class="n">spell_sequence</span><span class="p">,</span> <span class="n">_spellbook</span><span class="p">);</span>
        <span class="nn">theotterscrolls</span><span class="p">::</span><span class="nf">check_if_spell_casted</span><span class="p">(</span><span class="n">_spellbook</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>solve code, create index vector and call <code class="language-plaintext highlighter-rouge">cast_spell</code> funciton in <code class="language-plaintext highlighter-rouge">theotterscrolls</code> module. then, we need to change some code to get flag.</p><ol><li>host, port in <code class="language-plaintext highlighter-rouge">framework-solve/src/main.rs</code><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span> <span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span> <span class="n">Error</span><span class="o">&gt;&gt;</span> <span class="p">{</span>

 <span class="k">let</span> <span class="n">host</span> <span class="o">=</span> <span class="nn">env</span><span class="p">::</span><span class="nf">var</span><span class="p">(</span><span class="s">"HOST"</span><span class="p">)</span><span class="nf">.unwrap_or_else</span><span class="p">(|</span><span class="n">_</span><span class="p">|</span> <span class="s">"tos.nc.jctf.pro"</span><span class="nf">.to_string</span><span class="p">());</span> <span class="c1">// replace with remote ip</span>
 <span class="k">let</span> <span class="n">port</span> <span class="o">=</span> <span class="nn">env</span><span class="p">::</span><span class="nf">var</span><span class="p">(</span><span class="s">"PORT"</span><span class="p">)</span><span class="nf">.unwrap_or_else</span><span class="p">(|</span><span class="n">_</span><span class="p">|</span> <span class="s">"31337"</span><span class="nf">.to_string</span><span class="p">());</span>
</pre></table></code></div></div><li>challenge address in <code class="language-plaintext highlighter-rouge">framework-solve/dependency/Move.toml</code><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="o">...</span>
<span class="p">[</span><span class="n">addresses</span><span class="p">]</span>
<span class="n">admin</span> <span class="o">=</span> <span class="s">"0xfccc9a421bbb13c1a66a1aa98f0ad75029ede94857779c6915b44f94068b921e"</span>
<span class="n">challenge</span> <span class="o">=</span> <span class="s">"&lt;&gt;"</span>
</pre></table></code></div></div></ol><p>we can check the challenge address by simply connecting to server. It’s fixed and won’t be changed.</p><p>Next, we need to compile the module with sui build and run the rust code. it’s all in <code class="language-plaintext highlighter-rouge">sources/run_client.sh</code>. just run this script (we need to install sui). we can check a flag in <code class="language-plaintext highlighter-rouge">Connection Output</code></p><div class="language-text highlighter-rouge"><div class="code-header"> <span label-text="Text"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>➜  sources ./run_client.sh 
+ cd framework-solve/solve
+ sui move build
...
+ cd ..
+ cargo r --release
    Finished release [optimized] target(s) in 0.00s
     Running `target/release/solve-framework`
  - Connected!
  - Loaded solution!
  - Sent solution!
  - Connection Output: '[SERVER] Challenge modules published at: 542fe29e11d10314d3330e060c64f8fb9cd341981279432b03b2bd51cf5d489b[SERVER] Solution published at b4c0f35aeb28b4e0aa758f063059f3583d47686b0a057089f46bee4f474f871a'
  - Connection Output: '[SERVER] Congrats, flag: justCTF{Th4t_sp3ll_looks_d4ngerous...keep_y0ur_distance}'
  - Connection Output: ''
  - Terminated.
</pre></table></code></div></div><blockquote><p>justCTF{Th4t_sp3ll_looks_d4ngerous…keep_y0ur_distance}</p></blockquote><h2 id="dark-brotterhood">Dark BrOTTERhood<a href="#dark-brotterhood" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="goal">goal<a href="#goal" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p><code class="language-plaintext highlighter-rouge">dark_brotterhood.move</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre>    <span class="n">public</span> <span class="n">fun</span> <span class="nf">buy_flag</span><span class="p">(</span><span class="n">vault</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Vault</span><span class="o">&lt;</span><span class="n">OTTER</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">player</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Player</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">TxContext</span><span class="p">):</span> <span class="n">Flag</span> <span class="p">{</span>
        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="nn">coin</span><span class="p">::</span><span class="nf">value</span><span class="p">(</span><span class="o">&amp;</span><span class="n">player</span><span class="py">.coins</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1337</span><span class="p">,</span> <span class="n">WRONG_AMOUNT</span><span class="p">);</span> <span class="c1">// init * 10</span>

        <span class="k">let</span> <span class="n">coins</span> <span class="o">=</span> <span class="nn">coin</span><span class="p">::</span><span class="nf">split</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">player</span><span class="py">.coins</span><span class="p">,</span> <span class="mi">1337</span><span class="p">,</span> <span class="n">ctx</span><span class="p">);</span>
        <span class="nn">coin</span><span class="p">::</span><span class="nf">join</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">vault</span><span class="py">.cash</span><span class="p">,</span> <span class="n">coins</span><span class="p">);</span>

        <span class="n">Flag</span> <span class="p">{</span>
            <span class="n">id</span><span class="p">:</span> <span class="nn">object</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="n">ctx</span><span class="p">),</span>
            <span class="n">user</span><span class="p">:</span> <span class="nn">tx_context</span><span class="p">::</span><span class="nf">sender</span><span class="p">(</span><span class="n">ctx</span><span class="p">),</span>
            <span class="n">flag</span><span class="p">:</span> <span class="k">true</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="o">...</span>
    <span class="n">public</span> <span class="n">fun</span> <span class="nf">prove</span><span class="p">(</span><span class="n">board</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">QuestBoard</span><span class="p">,</span> <span class="n">flag</span><span class="p">:</span> <span class="n">Flag</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">Flag</span> <span class="p">{</span>
            <span class="n">id</span><span class="p">,</span>
            <span class="n">user</span><span class="p">,</span>
            <span class="n">flag</span>
        <span class="p">}</span> <span class="o">=</span> <span class="n">flag</span><span class="p">;</span>

        <span class="nn">object</span><span class="p">::</span><span class="nf">delete</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>

        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="nn">table</span><span class="p">::</span><span class="nf">contains</span><span class="p">(</span><span class="o">&amp;</span><span class="n">board</span><span class="py">.players</span><span class="p">,</span> <span class="n">user</span><span class="p">),</span> <span class="n">NOT_REGISTERED</span><span class="p">);</span>
        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">NOT_SOLVED</span><span class="p">);</span>
        <span class="o">*</span><span class="nn">table</span><span class="p">::</span><span class="nf">borrow_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">board</span><span class="py">.players</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="o">...</span>
    <span class="n">public</span> <span class="n">fun</span> <span class="nf">check_winner</span><span class="p">(</span><span class="n">board</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">QuestBoard</span><span class="p">,</span> <span class="n">player</span><span class="p">:</span> <span class="n">address</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="o">*</span><span class="nn">table</span><span class="p">::</span><span class="nf">borrow</span><span class="p">(</span><span class="o">&amp;</span><span class="n">board</span><span class="py">.players</span><span class="p">,</span> <span class="n">player</span><span class="p">)</span> <span class="o">==</span> <span class="k">true</span><span class="p">,</span> <span class="n">NOT_SOLVED</span><span class="p">);</span>
    <span class="p">}</span>
</pre></table></code></div></div><p>call <code class="language-plaintext highlighter-rouge">buy_flag</code> with 1337 coins and call <code class="language-plaintext highlighter-rouge">prove</code> to set the value of player to true</p><p><code class="language-plaintext highlighter-rouge">dark_brotterhood.move</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>  <span class="n">public</span> <span class="n">fun</span> <span class="nf">register</span><span class="p">(</span><span class="n">sup</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">OsecSuply</span><span class="o">&lt;</span><span class="n">OTTER</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">board</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">QuestBoard</span><span class="p">,</span> <span class="n">player</span><span class="p">:</span> <span class="n">address</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">TxContext</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="o">!</span><span class="nn">table</span><span class="p">::</span><span class="nf">contains</span><span class="p">(</span><span class="o">&amp;</span><span class="n">board</span><span class="py">.players</span><span class="p">,</span> <span class="n">player</span><span class="p">),</span> <span class="n">ALREADY_REGISTERED</span><span class="p">);</span>

        <span class="nn">table</span><span class="p">::</span><span class="nf">add</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">board</span><span class="py">.players</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>

        <span class="nn">transfer</span><span class="p">::</span><span class="nf">transfer</span><span class="p">(</span><span class="n">Player</span> <span class="p">{</span>
            <span class="n">id</span><span class="p">:</span> <span class="nn">object</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="n">ctx</span><span class="p">),</span>
            <span class="n">user</span><span class="p">:</span> <span class="nn">tx_context</span><span class="p">::</span><span class="nf">sender</span><span class="p">(</span><span class="n">ctx</span><span class="p">),</span>
            <span class="n">coins</span><span class="p">:</span> <span class="nf">mint</span><span class="p">(</span><span class="n">sup</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="n">ctx</span><span class="p">),</span> <span class="c1">// starts with 137</span>
            <span class="n">power</span><span class="p">:</span> <span class="mi">10</span>
        <span class="p">},</span> <span class="n">player</span><span class="p">);</span>
    <span class="p">}</span>
</pre></table></code></div></div><p>The server calls register function first, we starts with 137 OTTER coin and the power is 10</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>    <span class="n">public</span> <span class="n">fun</span> <span class="nf">buy_sword</span><span class="p">(</span><span class="n">vault</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Vault</span><span class="o">&lt;</span><span class="n">OTTER</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">player</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Player</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">TxContext</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="nn">coin</span><span class="p">::</span><span class="nf">value</span><span class="p">(</span><span class="o">&amp;</span><span class="n">player</span><span class="py">.coins</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">137</span><span class="p">,</span> <span class="n">WRONG_AMOUNT</span><span class="p">);</span>

        <span class="k">let</span> <span class="n">coins</span> <span class="o">=</span> <span class="nn">coin</span><span class="p">::</span><span class="nf">split</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">player</span><span class="py">.coins</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="n">ctx</span><span class="p">);</span>
        <span class="nn">coin</span><span class="p">::</span><span class="nf">join</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">vault</span><span class="py">.cash</span><span class="p">,</span> <span class="n">coins</span><span class="p">);</span>

        <span class="n">player</span><span class="py">.power</span> <span class="o">=</span> <span class="n">player</span><span class="py">.power</span> <span class="o">+</span> <span class="mi">100</span><span class="p">;</span>
    <span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">buy_sword</code> function, we can increase out power with 137 coins</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>    <span class="nd">#[allow(lint(public_random))]</span>
    <span class="n">public</span> <span class="n">fun</span> <span class="nf">find_a_monster</span><span class="p">(</span><span class="n">board</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">QuestBoard</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">Random</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">TxContext</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="nn">vector</span><span class="p">::</span><span class="nf">length</span><span class="p">(</span><span class="o">&amp;</span><span class="n">board</span><span class="py">.quests</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">QUEST_LIMIT</span><span class="p">,</span> <span class="n">TOO_MUCH_MONSTERS</span><span class="p">);</span>

        <span class="k">let</span> <span class="k">mut</span> <span class="n">generator</span> <span class="o">=</span> <span class="nn">random</span><span class="p">::</span><span class="nf">new_generator</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">ctx</span><span class="p">);</span>

        <span class="k">let</span> <span class="n">quest</span> <span class="o">=</span> <span class="n">Monster</span> <span class="p">{</span>
            <span class="n">fight_status</span><span class="p">:</span> <span class="n">NEW</span><span class="p">,</span>
            <span class="n">reward</span><span class="p">:</span> <span class="nn">random</span><span class="p">::</span><span class="nf">generate_u8_in_range</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">generator</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">37</span><span class="p">),</span>
            <span class="n">power</span><span class="p">:</span> <span class="nn">random</span><span class="p">::</span><span class="nf">generate_u8_in_range</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">generator</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">73</span><span class="p">)</span>
        <span class="p">};</span>

        <span class="nn">vector</span><span class="p">::</span><span class="nf">push_back</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">board</span><span class="py">.quests</span><span class="p">,</span> <span class="n">quest</span><span class="p">);</span>

    <span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">find_a_monster</code> function, we can push <code class="language-plaintext highlighter-rouge">Monster</code> objects to <code class="language-plaintext highlighter-rouge">quests</code> vector using push_back method. The limit is 25 (QUEST_LIMIT)</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>    <span class="n">public</span> <span class="n">fun</span> <span class="nf">fight_monster</span><span class="p">(</span><span class="n">board</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">QuestBoard</span><span class="p">,</span> <span class="n">player</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Player</span><span class="p">,</span> <span class="n">quest_id</span><span class="p">:</span> <span class="nb">u64</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">quest</span> <span class="o">=</span> <span class="nn">vector</span><span class="p">::</span><span class="nf">borrow_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">board</span><span class="py">.quests</span><span class="p">,</span> <span class="n">quest_id</span><span class="p">);</span>
        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="n">quest</span><span class="py">.fight_status</span> <span class="o">==</span> <span class="n">NEW</span><span class="p">,</span> <span class="n">WRONG_STATE</span><span class="p">);</span>
        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="n">player</span><span class="py">.power</span> <span class="o">&gt;</span> <span class="n">quest</span><span class="py">.power</span><span class="p">,</span> <span class="n">BETTER_BRING_A_KNIFE_TO_A_GUNFIGHT</span><span class="p">);</span>

        <span class="n">player</span><span class="py">.power</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// sword breaks after fighting the monster :c</span>

        <span class="n">quest</span><span class="py">.fight_status</span> <span class="o">=</span> <span class="n">WON</span><span class="p">;</span> <span class="c1">// !! quest.power do not changed</span>
    <span class="p">}</span>
</pre></table></code></div></div><p>fight_monster’ function, 2 constraints</p><ol><li><code class="language-plaintext highlighter-rouge">fight_status == NEW</code> ( can only be set in <code class="language-plaintext highlighter-rouge">find_a_monster</code> function )<li>player.power &gt; quest.power ( can only be increased in <code class="language-plaintext highlighter-rouge">buy_sword</code> function )</ol><p>It sets <code class="language-plaintext highlighter-rouge">player.power</code> to 10 and <code class="language-plaintext highlighter-rouge">quest.fight_status</code> to <code class="language-plaintext highlighter-rouge">WON</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>    <span class="n">public</span> <span class="n">fun</span> <span class="nf">return_home</span><span class="p">(</span><span class="n">board</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">QuestBoard</span><span class="p">,</span> <span class="n">quest_id</span><span class="p">:</span> <span class="nb">u64</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">quest_to_finish</span> <span class="o">=</span> <span class="nn">vector</span><span class="p">::</span><span class="nf">borrow_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">board</span><span class="py">.quests</span><span class="p">,</span> <span class="n">quest_id</span><span class="p">);</span>
        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="n">quest_to_finish</span><span class="py">.fight_status</span> <span class="o">==</span> <span class="n">WON</span><span class="p">,</span> <span class="n">WRONG_STATE</span><span class="p">);</span>

        <span class="n">quest_to_finish</span><span class="py">.fight_status</span> <span class="o">=</span> <span class="n">FINISHED</span><span class="p">;</span> <span class="c1">// only quest.status</span>
    <span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">return_home</code> sets <code class="language-plaintext highlighter-rouge">fight_status</code> to <code class="language-plaintext highlighter-rouge">FINISHED</code> it status is <code class="language-plaintext highlighter-rouge">WON</code> ( can only be set in <code class="language-plaintext highlighter-rouge">fight_monster</code> function</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre>    <span class="nd">#[allow(lint(self_transfer))]</span>
    <span class="n">public</span> <span class="n">fun</span> <span class="nf">get_the_reward</span><span class="p">(</span>
        <span class="n">vault</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Vault</span><span class="o">&lt;</span><span class="n">OTTER</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="n">board</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">QuestBoard</span><span class="p">,</span>
        <span class="n">player</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Player</span><span class="p">,</span>
        <span class="n">quest_id</span><span class="p">:</span> <span class="nb">u64</span><span class="p">,</span>
        <span class="n">ctx</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">TxContext</span><span class="p">,</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">quest_to_claim</span> <span class="o">=</span> <span class="nn">vector</span><span class="p">::</span><span class="nf">borrow_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">board</span><span class="py">.quests</span><span class="p">,</span> <span class="n">quest_id</span><span class="p">);</span> 
        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="n">quest_to_claim</span><span class="py">.fight_status</span> <span class="o">==</span> <span class="n">FINISHED</span><span class="p">,</span> <span class="n">WRONG_STATE</span><span class="p">);</span>

        <span class="k">let</span> <span class="n">monster</span> <span class="o">=</span> <span class="nn">vector</span><span class="p">::</span><span class="nf">pop_back</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">board</span><span class="py">.quests</span><span class="p">);</span> 

        <span class="k">let</span> <span class="n">Monster</span> <span class="p">{</span>
            <span class="n">fight_status</span><span class="p">:</span> <span class="n">_</span><span class="p">,</span>
            <span class="n">reward</span><span class="p">:</span> <span class="n">reward</span><span class="p">,</span>
            <span class="n">power</span><span class="p">:</span> <span class="n">_</span>
        <span class="p">}</span> <span class="o">=</span> <span class="n">monster</span><span class="p">;</span>

        <span class="k">let</span> <span class="n">coins</span> <span class="o">=</span> <span class="nn">coin</span><span class="p">::</span><span class="nf">split</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">vault</span><span class="py">.cash</span><span class="p">,</span> <span class="p">(</span><span class="n">reward</span> <span class="k">as</span> <span class="nb">u64</span><span class="p">),</span> <span class="n">ctx</span><span class="p">);</span> 
        <span class="nn">coin</span><span class="p">::</span><span class="nf">join</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">player</span><span class="py">.coins</span><span class="p">,</span> <span class="n">coins</span><span class="p">);</span>
    <span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">get_the_reward</code> function, It gets the quest status using <code class="language-plaintext highlighter-rouge">quest_id</code> and checks if it’s <code class="language-plaintext highlighter-rouge">FINISHED</code>, then It gets monster object with <code class="language-plaintext highlighter-rouge">pop_back</code> method and <code class="language-plaintext highlighter-rouge">only</code> get reward from it and send that amount to user.</p><p>If the length of the quest is 1, it works correctly. However, if the length of the quest is greater than 1, the quest being checked and the quest from which the reward is being retrieved become different. Instead of removing the checked quest, the quest from the end of the vector is removed from the vector.</p><p>By leaving a quest with the <code class="language-plaintext highlighter-rouge">FINISHED</code> status at the front of the vector, we can repeatedly call the <code class="language-plaintext highlighter-rouge">find_a_monster</code> and <code class="language-plaintext highlighter-rouge">get_the_reward</code> functions without fighting the monster to earn 1337 gold.</p><p><code class="language-plaintext highlighter-rouge">solve.move</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="n">module</span> <span class="nn">solve</span><span class="p">::</span><span class="n">solve</span> <span class="p">{</span>

    <span class="c1">// [*] Import dependencies</span>
    <span class="k">use</span> <span class="nn">challenge</span><span class="p">::</span><span class="nn">Otter</span><span class="p">::{</span><span class="k">Self</span><span class="p">,</span> <span class="n">OTTER</span><span class="p">,</span> <span class="n">Flag</span><span class="p">};</span>
    <span class="k">use</span> <span class="nn">sui</span><span class="p">::</span><span class="nn">random</span><span class="p">::</span><span class="n">Random</span><span class="p">;</span>

    <span class="nd">#[allow(lint(public_random))]</span>
    <span class="n">public</span> <span class="n">fun</span> <span class="nf">solve</span><span class="p">(</span>
        <span class="n">_vault</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nn">Otter</span><span class="p">::</span><span class="n">Vault</span><span class="o">&lt;</span><span class="n">OTTER</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="n">_questboard</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nn">Otter</span><span class="p">::</span><span class="n">QuestBoard</span><span class="p">,</span>
        <span class="n">_player</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nn">Otter</span><span class="p">::</span><span class="n">Player</span><span class="p">,</span>
        <span class="n">_r</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">Random</span><span class="p">,</span>
        <span class="n">_ctx</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">TxContext</span><span class="p">,</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="nn">Otter</span><span class="p">::</span><span class="nf">find_a_monster</span><span class="p">(</span><span class="n">_questboard</span><span class="p">,</span> <span class="n">_r</span><span class="p">,</span> <span class="n">_ctx</span><span class="p">);</span>
        <span class="nn">Otter</span><span class="p">::</span><span class="nf">buy_sword</span><span class="p">(</span><span class="n">_vault</span><span class="p">,</span> <span class="n">_player</span><span class="p">,</span> <span class="n">_ctx</span><span class="p">);</span>
        <span class="nn">Otter</span><span class="p">::</span><span class="nf">fight_monster</span><span class="p">(</span><span class="n">_questboard</span><span class="p">,</span> <span class="n">_player</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="nn">Otter</span><span class="p">::</span><span class="nf">return_home</span><span class="p">(</span><span class="n">_questboard</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

        <span class="k">let</span> <span class="k">mut</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">loop</span> <span class="p">{</span>
            <span class="nn">Otter</span><span class="p">::</span><span class="nf">find_a_monster</span><span class="p">(</span><span class="n">_questboard</span><span class="p">,</span> <span class="n">_r</span><span class="p">,</span> <span class="n">_ctx</span><span class="p">);</span>
            <span class="nn">Otter</span><span class="p">::</span><span class="nf">get_the_reward</span><span class="p">(</span><span class="n">_vault</span><span class="p">,</span> <span class="n">_questboard</span><span class="p">,</span> <span class="n">_player</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">_ctx</span><span class="p">);</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">&gt;=</span><span class="mi">100</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">};</span>

        <span class="k">let</span> <span class="n">flag</span> <span class="o">=</span> <span class="nn">Otter</span><span class="p">::</span><span class="nf">buy_flag</span><span class="p">(</span><span class="n">_vault</span><span class="p">,</span> <span class="n">_player</span><span class="p">,</span> <span class="n">_ctx</span><span class="p">);</span>
        <span class="nn">Otter</span><span class="p">::</span><span class="nf">prove</span><span class="p">(</span><span class="n">_questboard</span><span class="p">,</span> <span class="n">flag</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p>justCTF{I_us3d_to_b3_an_ott3r_until_i_t00k_th4t_arr0w}</p></blockquote><h2 id="world-of-ottercraft">World of Ottercraft<a href="#world-of-ottercraft" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="goal-1">goal<a href="#goal-1" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre>    <span class="n">public</span> <span class="n">fun</span> <span class="nf">buy_flag</span><span class="p">(</span><span class="n">ticket</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">TawernTicket</span><span class="p">,</span> <span class="n">player</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Player</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="n">player</span><span class="py">.status</span> <span class="o">==</span> <span class="n">SHOPPING</span><span class="p">,</span> <span class="n">WRONG_PLAYER_STATE</span><span class="p">);</span>

        <span class="n">ticket</span><span class="py">.total</span> <span class="o">=</span> <span class="n">ticket</span><span class="py">.total</span> <span class="o">+</span> <span class="mi">537</span><span class="p">;</span>
        <span class="n">ticket</span><span class="py">.flag_bought</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">fun</span> <span class="nf">checkout</span><span class="p">(</span><span class="n">ticket</span><span class="p">:</span> <span class="n">TawernTicket</span><span class="p">,</span> <span class="n">player</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Player</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">TxContext</span><span class="p">,</span> <span class="n">vault</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Vault</span><span class="o">&lt;</span><span class="n">OTTER</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">board</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">QuestBoard</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">TawernTicket</span><span class="p">{</span> <span class="n">total</span><span class="p">,</span> <span class="n">flag_bought</span> <span class="p">}</span> <span class="o">=</span> <span class="n">ticket</span><span class="p">;</span>

        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="n">total</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">BUY_SOMETHING</span><span class="p">);</span>  
        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="nn">balance</span><span class="p">::</span><span class="n">value</span><span class="o">&lt;</span><span class="n">OTTER</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">player</span><span class="py">.wallet</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">total</span><span class="p">,</span> <span class="n">WRONG_AMOUNT</span><span class="p">);</span>

        <span class="k">let</span> <span class="n">balance</span> <span class="o">=</span> <span class="nn">balance</span><span class="p">::</span><span class="nf">split</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">player</span><span class="py">.wallet</span><span class="p">,</span> <span class="n">total</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">coins</span> <span class="o">=</span> <span class="nn">coin</span><span class="p">::</span><span class="nf">from_balance</span><span class="p">(</span><span class="n">balance</span><span class="p">,</span> <span class="n">ctx</span><span class="p">);</span>

        <span class="nn">coin</span><span class="p">::</span><span class="nf">join</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">vault</span><span class="py">.cash</span><span class="p">,</span> <span class="n">coins</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">flag_bought</span> <span class="o">==</span> <span class="k">true</span><span class="p">)</span> <span class="p">{</span>

            <span class="k">let</span> <span class="n">flag</span> <span class="o">=</span> <span class="nn">table</span><span class="p">::</span><span class="nf">borrow_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">board</span><span class="py">.players</span><span class="p">,</span> <span class="nn">tx_context</span><span class="p">::</span><span class="nf">sender</span><span class="p">(</span><span class="n">ctx</span><span class="p">));</span>
            <span class="o">*</span><span class="n">flag</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>

            <span class="nn">std</span><span class="p">::</span><span class="nn">debug</span><span class="p">::</span><span class="nf">print</span><span class="p">(</span><span class="o">&amp;</span><span class="nn">std</span><span class="p">::</span><span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"$$$$$$$$$$$$$$$$$$$$$$$$$ FLAG BOUGHT $$$$$$$$$$$$$$$$$$$$$$$$$"</span><span class="p">));</span> <span class="c1">//debug</span>
        <span class="p">};</span>

        <span class="n">player</span><span class="py">.status</span> <span class="o">=</span> <span class="n">RESTING</span><span class="p">;</span>
    <span class="p">}</span>
</pre></table></code></div></div><p>buy flag with 537 coin and call checkout function. It looks similar to <code class="language-plaintext highlighter-rouge">Dark BrOTTERhood</code> challenge but this challenge released earlier.</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>    <span class="c1">// STATUSES</span>
    <span class="k">const</span> <span class="n">PREPARE_FOR_TROUBLE</span><span class="p">:</span> <span class="nb">u64</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ON_ADVENTURE</span><span class="p">:</span> <span class="nb">u64</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">RESTING</span><span class="p">:</span> <span class="nb">u64</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">SHOPPING</span><span class="p">:</span> <span class="nb">u64</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">FINISHED</span><span class="p">:</span> <span class="nb">u64</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</pre></table></code></div></div><p>there are 5 status.</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>    <span class="n">public</span> <span class="k">struct</span> <span class="n">TawernTicket</span> <span class="p">{</span>
        <span class="n">total</span><span class="p">:</span> <span class="nb">u64</span><span class="p">,</span>
        <span class="n">flag_bought</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">}</span>
    <span class="o">...</span>
    <span class="n">public</span> <span class="n">fun</span> <span class="nf">enter_tavern</span><span class="p">(</span><span class="n">player</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Player</span><span class="p">):</span> <span class="n">TawernTicket</span> <span class="p">{</span>
        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="n">player</span><span class="py">.status</span> <span class="o">==</span> <span class="n">RESTING</span><span class="p">,</span> <span class="n">WRONG_PLAYER_STATE</span><span class="p">);</span>

        <span class="n">player</span><span class="py">.status</span> <span class="o">=</span> <span class="n">SHOPPING</span><span class="p">;</span>

        <span class="n">TawernTicket</span><span class="p">{</span> <span class="n">total</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">flag_bought</span><span class="p">:</span> <span class="k">false</span> <span class="p">}</span>
    <span class="p">}</span>
</pre></table></code></div></div><p>I think this is import part of my solver code. we should call <code class="language-plaintext highlighter-rouge">enter_tavern</code> to buy something. The player will get TawernTicket object by calling this function. we should send ownership by calling <code class="language-plaintext highlighter-rouge">checkout</code> function before return. because there’s no <code class="language-plaintext highlighter-rouge">drop</code> in TawernTicket. As I know, there’s no way to drop this object without sending it to the <code class="language-plaintext highlighter-rouge">checkout</code> function. Idk rust and move this mush ( this is first time for me )</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre>    <span class="n">public</span> <span class="n">fun</span> <span class="nf">buy_flag</span><span class="p">(</span><span class="n">ticket</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">TawernTicket</span><span class="p">,</span> <span class="n">player</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Player</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="n">player</span><span class="py">.status</span> <span class="o">==</span> <span class="n">SHOPPING</span><span class="p">,</span> <span class="n">WRONG_PLAYER_STATE</span><span class="p">);</span>

        <span class="n">ticket</span><span class="py">.total</span> <span class="o">=</span> <span class="n">ticket</span><span class="py">.total</span> <span class="o">+</span> <span class="mi">537</span><span class="p">;</span>
        <span class="n">ticket</span><span class="py">.flag_bought</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">fun</span> <span class="nf">buy_sword</span><span class="p">(</span><span class="n">player</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Player</span><span class="p">,</span> <span class="n">ticket</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">TawernTicket</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="n">player</span><span class="py">.status</span> <span class="o">==</span> <span class="n">SHOPPING</span><span class="p">,</span> <span class="n">WRONG_PLAYER_STATE</span><span class="p">);</span>

        <span class="n">player</span><span class="py">.power</span> <span class="o">=</span> <span class="n">player</span><span class="py">.power</span> <span class="o">+</span> <span class="mi">213</span><span class="p">;</span>
        <span class="n">ticket</span><span class="py">.total</span> <span class="o">=</span> <span class="n">ticket</span><span class="py">.total</span> <span class="o">+</span> <span class="mi">140</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">fun</span> <span class="nf">buy_shield</span><span class="p">(</span><span class="n">player</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Player</span><span class="p">,</span> <span class="n">ticket</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">TawernTicket</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="n">player</span><span class="py">.status</span> <span class="o">==</span> <span class="n">SHOPPING</span><span class="p">,</span> <span class="n">WRONG_PLAYER_STATE</span><span class="p">);</span>

        <span class="n">player</span><span class="py">.power</span> <span class="o">=</span> <span class="n">player</span><span class="py">.power</span> <span class="o">+</span> <span class="mi">7</span><span class="p">;</span>
        <span class="n">ticket</span><span class="py">.total</span> <span class="o">=</span> <span class="n">ticket</span><span class="py">.total</span> <span class="o">+</span> <span class="mi">20</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">fun</span> <span class="nf">buy_power_of_friendship</span><span class="p">(</span><span class="n">player</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Player</span><span class="p">,</span> <span class="n">ticket</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">TawernTicket</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="n">player</span><span class="py">.status</span> <span class="o">==</span> <span class="n">SHOPPING</span><span class="p">,</span> <span class="n">WRONG_PLAYER_STATE</span><span class="p">);</span>

        <span class="n">player</span><span class="py">.power</span> <span class="o">=</span> <span class="n">player</span><span class="py">.power</span> <span class="o">+</span> <span class="mi">9000</span><span class="p">;</span> <span class="c1">//it's over 9000!</span>
        <span class="n">ticket</span><span class="py">.total</span> <span class="o">=</span> <span class="n">ticket</span><span class="py">.total</span> <span class="o">+</span> <span class="mi">190</span><span class="p">;</span>
    <span class="p">}</span>
</pre></table></code></div></div><p>There are 4 items. The shield is the cheapest. only <code class="language-plaintext highlighter-rouge">SHOPPING</code> status is allowed ( only set in <code class="language-plaintext highlighter-rouge">enter_tavern</code> function )</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre>    <span class="n">public</span> <span class="n">fun</span> <span class="nf">checkout</span><span class="p">(</span><span class="n">ticket</span><span class="p">:</span> <span class="n">TawernTicket</span><span class="p">,</span> <span class="n">player</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Player</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">TxContext</span><span class="p">,</span> <span class="n">vault</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Vault</span><span class="o">&lt;</span><span class="n">OTTER</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">board</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">QuestBoard</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">TawernTicket</span><span class="p">{</span> <span class="n">total</span><span class="p">,</span> <span class="n">flag_bought</span> <span class="p">}</span> <span class="o">=</span> <span class="n">ticket</span><span class="p">;</span>

        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="n">total</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">BUY_SOMETHING</span><span class="p">);</span>  
        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="nn">balance</span><span class="p">::</span><span class="n">value</span><span class="o">&lt;</span><span class="n">OTTER</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">player</span><span class="py">.wallet</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">total</span><span class="p">,</span> <span class="n">WRONG_AMOUNT</span><span class="p">);</span>

        <span class="k">let</span> <span class="n">balance</span> <span class="o">=</span> <span class="nn">balance</span><span class="p">::</span><span class="nf">split</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">player</span><span class="py">.wallet</span><span class="p">,</span> <span class="n">total</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">coins</span> <span class="o">=</span> <span class="nn">coin</span><span class="p">::</span><span class="nf">from_balance</span><span class="p">(</span><span class="n">balance</span><span class="p">,</span> <span class="n">ctx</span><span class="p">);</span>

        <span class="nn">coin</span><span class="p">::</span><span class="nf">join</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">vault</span><span class="py">.cash</span><span class="p">,</span> <span class="n">coins</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">flag_bought</span> <span class="o">==</span> <span class="k">true</span><span class="p">)</span> <span class="p">{</span>

            <span class="k">let</span> <span class="n">flag</span> <span class="o">=</span> <span class="nn">table</span><span class="p">::</span><span class="nf">borrow_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">board</span><span class="py">.players</span><span class="p">,</span> <span class="nn">tx_context</span><span class="p">::</span><span class="nf">sender</span><span class="p">(</span><span class="n">ctx</span><span class="p">));</span>
            <span class="o">*</span><span class="n">flag</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>

            <span class="nn">std</span><span class="p">::</span><span class="nn">debug</span><span class="p">::</span><span class="nf">print</span><span class="p">(</span><span class="o">&amp;</span><span class="nn">std</span><span class="p">::</span><span class="nn">string</span><span class="p">::</span><span class="nf">utf8</span><span class="p">(</span><span class="s">b"$$$$$$$$$$$$$$$$$$$$$$$$$ FLAG BOUGHT $$$$$$$$$$$$$$$$$$$$$$$$$"</span><span class="p">));</span> <span class="c1">//debug</span>
        <span class="p">};</span>

        <span class="n">player</span><span class="py">.status</span> <span class="o">=</span> <span class="n">RESTING</span><span class="p">;</span>
    <span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">checkout</code>, all status is allowed. <code class="language-plaintext highlighter-rouge">player.status = RESTING</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre>    <span class="n">public</span> <span class="n">fun</span> <span class="nf">find_a_monster</span><span class="p">(</span><span class="n">board</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">QuestBoard</span><span class="p">,</span> <span class="n">player</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Player</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// RESTING, PREPARE_FOR_TROUBLE</span>
        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="n">player</span><span class="py">.status</span> <span class="o">!=</span> <span class="n">SHOPPING</span> <span class="o">&amp;&amp;</span> <span class="n">player</span><span class="py">.status</span> <span class="o">!=</span> <span class="n">FINISHED</span> <span class="o">&amp;&amp;</span> <span class="n">player</span><span class="py">.status</span> <span class="o">!=</span> <span class="n">ON_ADVENTURE</span><span class="p">,</span> <span class="n">WRONG_PLAYER_STATE</span><span class="p">);</span>
        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="nn">vector</span><span class="p">::</span><span class="nf">length</span><span class="p">(</span><span class="o">&amp;</span><span class="n">board</span><span class="py">.quests</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">QUEST_LIMIT</span><span class="p">,</span> <span class="n">TOO_MANY_MONSTERS</span><span class="p">);</span>
        <span class="c1">// verify with quest length, so can always get rewarad:100, power:73</span>
        <span class="k">let</span> <span class="n">quest</span> <span class="o">=</span> <span class="k">if</span> <span class="p">(</span><span class="nn">vector</span><span class="p">::</span><span class="nf">length</span><span class="p">(</span><span class="o">&amp;</span><span class="n">board</span><span class="py">.quests</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">Monster</span> <span class="p">{</span>
                <span class="n">reward</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                <span class="n">power</span><span class="p">:</span> <span class="mi">73</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nn">vector</span><span class="p">::</span><span class="nf">length</span><span class="p">(</span><span class="o">&amp;</span><span class="n">board</span><span class="py">.quests</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">Monster</span> <span class="p">{</span>
                <span class="n">reward</span><span class="p">:</span> <span class="mi">62</span><span class="p">,</span>
                <span class="n">power</span><span class="p">:</span> <span class="mi">81</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">Monster</span> <span class="p">{</span>
                <span class="n">reward</span><span class="p">:</span> <span class="mi">79</span><span class="p">,</span>
                <span class="n">power</span><span class="p">:</span> <span class="mi">94</span>
            <span class="p">}</span>
        <span class="p">};</span>

        <span class="nn">vector</span><span class="p">::</span><span class="nf">push_back</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">board</span><span class="py">.quests</span><span class="p">,</span> <span class="n">quest</span><span class="p">);</span>
        <span class="n">player</span><span class="py">.status</span> <span class="o">=</span> <span class="n">PREPARE_FOR_TROUBLE</span><span class="p">;</span>
    <span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">find_a_monster</code>, we can push Monster object to quests vector. only <code class="language-plaintext highlighter-rouge">RESTING</code>, <code class="language-plaintext highlighter-rouge">PREPARE_FOR_TROUBLE</code> status are allowed. <code class="language-plaintext highlighter-rouge">player.status = PREPARE_FOR_TROUBLE</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>    <span class="n">public</span> <span class="n">fun</span> <span class="nf">bring_it_on</span><span class="p">(</span><span class="n">board</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">QuestBoard</span><span class="p">,</span> <span class="n">player</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Player</span><span class="p">,</span> <span class="n">quest_id</span><span class="p">:</span> <span class="nb">u64</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// PREPARE_FOR_TROUBLE</span>
        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="n">player</span><span class="py">.status</span> <span class="o">!=</span> <span class="n">SHOPPING</span> <span class="o">&amp;&amp;</span> <span class="n">player</span><span class="py">.status</span> <span class="o">!=</span> <span class="n">FINISHED</span> <span class="o">&amp;&amp;</span> <span class="n">player</span><span class="py">.status</span> <span class="o">!=</span> <span class="n">RESTING</span> <span class="o">&amp;&amp;</span> <span class="n">player</span><span class="py">.status</span> <span class="o">!=</span> <span class="n">ON_ADVENTURE</span><span class="p">,</span> <span class="n">WRONG_PLAYER_STATE</span><span class="p">);</span>

        <span class="k">let</span> <span class="n">monster</span> <span class="o">=</span> <span class="nn">vector</span><span class="p">::</span><span class="nf">borrow_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">board</span><span class="py">.quests</span><span class="p">,</span> <span class="n">quest_id</span><span class="p">);</span>
        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="n">player</span><span class="py">.power</span> <span class="o">&gt;</span> <span class="n">monster</span><span class="py">.power</span><span class="p">,</span> <span class="n">BETTER_GET_EQUIPPED</span><span class="p">);</span>

        <span class="n">player</span><span class="py">.status</span> <span class="o">=</span> <span class="n">ON_ADVENTURE</span><span class="p">;</span>

        <span class="n">player</span><span class="py">.power</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">//equipment breaks after fighting the monster, and friends go to party :c</span>
        <span class="n">monster</span><span class="py">.power</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//you win! wow!</span>
        <span class="n">player</span><span class="py">.quest_index</span> <span class="o">=</span> <span class="n">quest_id</span><span class="p">;</span>
    <span class="p">}</span>
</pre></table></code></div></div><p>It gets monster using <code class="language-plaintext highlighter-rouge">quest_id</code> and checks power, then set <code class="language-plaintext highlighter-rouge">monster's power</code> to 0, quest_index to <code class="language-plaintext highlighter-rouge">quest_id</code>. only <code class="language-plaintext highlighter-rouge">PREPARE_FOR_TROUBLE</code> status is allowed.</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>    <span class="n">public</span> <span class="n">fun</span> <span class="nf">return_home</span><span class="p">(</span><span class="n">board</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">QuestBoard</span><span class="p">,</span> <span class="n">player</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Player</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// ON_ADVENTURE</span>
        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="n">player</span><span class="py">.status</span> <span class="o">!=</span> <span class="n">SHOPPING</span> <span class="o">&amp;&amp;</span> <span class="n">player</span><span class="py">.status</span> <span class="o">!=</span> <span class="n">FINISHED</span> <span class="o">&amp;&amp;</span> <span class="n">player</span><span class="py">.status</span> <span class="o">!=</span> <span class="n">RESTING</span> <span class="o">&amp;&amp;</span> <span class="n">player</span><span class="py">.status</span> <span class="o">!=</span> <span class="n">PREPARE_FOR_TROUBLE</span><span class="p">,</span> <span class="n">WRONG_PLAYER_STATE</span><span class="p">);</span>

        <span class="k">let</span> <span class="n">quest_to_finish</span> <span class="o">=</span> <span class="nn">vector</span><span class="p">::</span><span class="nf">borrow</span><span class="p">(</span><span class="o">&amp;</span><span class="n">board</span><span class="py">.quests</span><span class="p">,</span> <span class="n">player</span><span class="py">.quest_index</span><span class="p">);</span>
        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="n">quest_to_finish</span><span class="py">.power</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">WRONG_AMOUNT</span><span class="p">);</span>

        <span class="n">player</span><span class="py">.status</span> <span class="o">=</span> <span class="n">FINISHED</span><span class="p">;</span>
    <span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">return_home</code>, It gets quest using <code class="language-plaintext highlighter-rouge">player.quest_index</code> ( set in <code class="language-plaintext highlighter-rouge">bring_it_on function</code> ) and checks <code class="language-plaintext highlighter-rouge">power==0</code>. only <code class="language-plaintext highlighter-rouge">ON_ADVENTURE</code> status is allowed.</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>    <span class="n">public</span> <span class="n">fun</span> <span class="nf">get_the_reward</span><span class="p">(</span><span class="n">vault</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Vault</span><span class="o">&lt;</span><span class="n">OTTER</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">board</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">QuestBoard</span><span class="p">,</span> <span class="n">player</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Player</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">TxContext</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// FINISHED, SHOPPING</span>
        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="n">player</span><span class="py">.status</span> <span class="o">!=</span> <span class="n">RESTING</span> <span class="o">&amp;&amp;</span> <span class="n">player</span><span class="py">.status</span> <span class="o">!=</span> <span class="n">PREPARE_FOR_TROUBLE</span> <span class="o">&amp;&amp;</span> <span class="n">player</span><span class="py">.status</span> <span class="o">!=</span> <span class="n">ON_ADVENTURE</span><span class="p">,</span> <span class="n">WRONG_PLAYER_STATE</span><span class="p">);</span>

        <span class="k">let</span> <span class="n">monster</span> <span class="o">=</span> <span class="nn">vector</span><span class="p">::</span><span class="nf">remove</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">board</span><span class="py">.quests</span><span class="p">,</span> <span class="n">player</span><span class="py">.quest_index</span><span class="p">);</span>

        <span class="k">let</span> <span class="n">Monster</span> <span class="p">{</span>   <span class="c1">// do not check monster power</span>
            <span class="n">reward</span><span class="p">:</span> <span class="n">reward</span><span class="p">,</span>
            <span class="n">power</span><span class="p">:</span> <span class="n">_</span>
        <span class="p">}</span> <span class="o">=</span> <span class="n">monster</span><span class="p">;</span>

        <span class="k">let</span> <span class="n">coins</span> <span class="o">=</span> <span class="nn">coin</span><span class="p">::</span><span class="nf">split</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">vault</span><span class="py">.cash</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">ctx</span><span class="p">);</span> 
        <span class="k">let</span> <span class="n">balance</span> <span class="o">=</span> <span class="nn">coin</span><span class="p">::</span><span class="nf">into_balance</span><span class="p">(</span><span class="n">coins</span><span class="p">);</span>

        <span class="nn">balance</span><span class="p">::</span><span class="nf">join</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">player</span><span class="py">.wallet</span><span class="p">,</span> <span class="n">balance</span><span class="p">);</span>

        <span class="n">player</span><span class="py">.status</span> <span class="o">=</span> <span class="n">RESTING</span><span class="p">;</span>
    <span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">get_the_reward</code>, It’s different from previous challenge. It uses <code class="language-plaintext highlighter-rouge">remove</code> using <code class="language-plaintext highlighter-rouge">player.quest_index</code> as index, not <code class="language-plaintext highlighter-rouge">pop_back</code>.</p><p>Not only the <code class="language-plaintext highlighter-rouge">FINISHED</code> status from <code class="language-plaintext highlighter-rouge">return_home</code>, but also the <code class="language-plaintext highlighter-rouge">SHOPPING</code> status is allowed. In <code class="language-plaintext highlighter-rouge">vector::remove</code>, if we delete index 0, index 0 now points to the element that was previously at index 1. There’s no check of the power of monster. So we can collect all rewards in the quest vector by killing only the monster at index 0.</p><p><img data-src="/assets/img/2024-06-16-justCTF/Pasted image 20240616211734.png" alt="img2.png" data-proofer-ignore> It seems we can call <code class="language-plaintext highlighter-rouge">get_the_reward, enter_tavern</code> function repeatedly. But as I mentioned above, we must send transfer ownership of ticket object to <code class="language-plaintext highlighter-rouge">checkout</code> function before <code class="language-plaintext highlighter-rouge">return</code>. So we should call the functions in the following order</p><ol><li>buy sword<li>fill the vector with monsters until LIMIT (25)<li>kill monster at index 0<li>repeat below<li>enter_tavern<li>buy_shield -&gt; Cheapest. Just to bypass <code class="language-plaintext highlighter-rouge">assert!(total &gt; 0, BUY_SOMETHING);</code>.<li>get_the_reward<li>checkout -&gt; transfer ownership of ticket</ol><p>All of the monsters’ rewards are lower than the price of a shield, so we can get 537 coins.</p><p><code class="language-plaintext highlighter-rouge">solve.move</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre><td class="rouge-code"><pre><span class="nd">#[allow(unused,</span> <span class="nd">unused_use,</span> <span class="nd">unused_variable,</span> <span class="nd">duplicate_alias)]</span>
<span class="n">module</span> <span class="nn">solve</span><span class="p">::</span><span class="n">solve</span> <span class="p">{</span>

    <span class="c1">// [*] Import dependencies</span>
    <span class="k">use</span> <span class="nn">challenge</span><span class="p">::</span><span class="nn">Otter</span><span class="p">::{</span><span class="k">Self</span><span class="p">,</span> <span class="n">OTTER</span><span class="p">,</span> <span class="n">QuestBoard</span><span class="p">,</span> <span class="n">Vault</span><span class="p">,</span> <span class="n">Player</span><span class="p">,</span> <span class="n">TawernTicket</span><span class="p">};</span>
    <span class="n">public</span> <span class="n">fun</span> <span class="nf">solve</span><span class="p">(</span>
        <span class="n">board</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">QuestBoard</span><span class="p">,</span>
        <span class="n">vault</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Vault</span><span class="o">&lt;</span><span class="n">OTTER</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="n">player</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Player</span><span class="p">,</span>
        <span class="n">ctx</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">TxContext</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">ticket</span> <span class="o">=</span> <span class="nn">Otter</span><span class="p">::</span><span class="nf">enter_tavern</span><span class="p">(</span><span class="n">player</span><span class="p">);</span>
        <span class="nn">Otter</span><span class="p">::</span><span class="nf">buy_sword</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">ticket</span><span class="p">);</span>
        <span class="nn">Otter</span><span class="p">::</span><span class="nf">checkout</span><span class="p">(</span><span class="n">ticket</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">vault</span><span class="p">,</span> <span class="n">board</span><span class="p">);</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">loop</span> <span class="p">{</span>
            <span class="nn">Otter</span><span class="p">::</span><span class="nf">find_a_monster</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="n">player</span><span class="p">);</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">25</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">};</span>
        <span class="nn">Otter</span><span class="p">::</span><span class="nf">bring_it_on</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="nn">Otter</span><span class="p">::</span><span class="nf">return_home</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="n">player</span><span class="p">);</span>
        <span class="nn">Otter</span><span class="p">::</span><span class="nf">get_the_reward</span><span class="p">(</span><span class="n">vault</span><span class="p">,</span> <span class="n">board</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">ctx</span><span class="p">);</span>

        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">loop</span> <span class="p">{</span>
            <span class="k">let</span> <span class="k">mut</span> <span class="n">ticket</span> <span class="o">=</span> <span class="nn">Otter</span><span class="p">::</span><span class="nf">enter_tavern</span><span class="p">(</span><span class="n">player</span><span class="p">);</span>
            <span class="nn">Otter</span><span class="p">::</span><span class="nf">buy_shield</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">ticket</span><span class="p">);</span>
            <span class="nn">Otter</span><span class="p">::</span><span class="nf">get_the_reward</span><span class="p">(</span><span class="n">vault</span><span class="p">,</span> <span class="n">board</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">ctx</span><span class="p">);</span>
            <span class="nn">Otter</span><span class="p">::</span><span class="nf">checkout</span><span class="p">(</span><span class="n">ticket</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">vault</span><span class="p">,</span> <span class="n">board</span><span class="p">);</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">24</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">};</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">ticket</span> <span class="o">=</span> <span class="nn">Otter</span><span class="p">::</span><span class="nf">enter_tavern</span><span class="p">(</span><span class="n">player</span><span class="p">);</span>
        <span class="nn">Otter</span><span class="p">::</span><span class="nf">buy_flag</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">ticket</span><span class="p">,</span> <span class="n">player</span><span class="p">);</span>
        <span class="nn">Otter</span><span class="p">::</span><span class="nf">checkout</span><span class="p">(</span><span class="n">ticket</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">vault</span><span class="p">,</span> <span class="n">board</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p>justCTF{Ott3r_uses_expl0it_its_sup3r_eff3ctiv3}</p></blockquote></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ctf/'>CTF</a>, <a href='/categories/web3/'>WEB3</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/writeup/" class="post-tag no-text-decoration" >writeup</a> <a href="/tags/web3/" class="post-tag no-text-decoration" >web3</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=(CTF) justCTF 2024 writeup (Blockchains) - snwo&url=http://blog.solidity.kr/posts/(ctf)-2024-justCTF/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=(CTF) justCTF 2024 writeup (Blockchains) - snwo&u=http://blog.solidity.kr/posts/(ctf)-2024-justCTF/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=(CTF) justCTF 2024 writeup (Blockchains) - snwo&url=http://blog.solidity.kr/posts/(ctf)-2024-justCTF/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/(ctf)-sonic-jailbreak-hackathon/">(CTF) Sonic Jailbreak hackathon writeup</a><li><a href="/posts/(ctf)-bi0s-ctf-2025/">(CTF) bi0s CTF 2025 writeup (blockchains)</a><li><a href="/posts/(ctf)-2024-eth-escape-ctf/">(CTF) ETH Escape CTF 2024 writeup (Feel, Vest, MAZE)</a><li><a href="/posts/(ctf)-2024-blazCTF/">(CTF) blazCTF 2024 writeup (Chisel as a Service, teragas)</a><li><a href="/posts/(ctf)-2024-SekaiCTF/">(CTF) SekaiCTF 2024 writeup (ZOO)</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/web3/">web3</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/(ctf)-2024-realworldctf/"><div class="card-body"> <em class="timeago small" date="2024-01-30 17:02:13 +0900" >Jan 30, 2024</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>(CTF) realworld CTF 2024 writeup (SafeBridge)</h3><div class="text-muted small"><p> web3 newbie’s solver for SafeBridge in rwctf 2024 Objective Drain the BRIDGE (L1ERC20Bridge) of its WETH balance. Setup The challenge setup is using the challenge.py file, with relayer.py also ...</p></div></div></a></div><div class="card"> <a href="/posts/(ctf)-2024-SekaiCTF/"><div class="card-body"> <em class="timeago small" date="2024-08-27 05:02:13 +0900" >Aug 27, 2024</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>(CTF) SekaiCTF 2024 writeup (ZOO)</h3><div class="text-muted small"><p> I made solidity assembly challenge in sekai ctf 2024. ended up with 13 solves. you can check the detail here ZOO welcome to assembly zoo There are two functions, fallback and commit (interna...</p></div></div></a></div><div class="card"> <a href="/posts/(ctf)-2024-blazCTF/"><div class="card-body"> <em class="timeago small" date="2024-09-27 05:02:13 +0900" >Sep 27, 2024</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>(CTF) blazCTF 2024 writeup (Chisel as a Service, teragas)</h3><div class="text-muted small"><p> I played blaz CTF as KimchiPremium, had a lot of fun with the awesome kimchi hackers Chisel as a Service Chisel as a Service Mina just develops a highly robust Solidity sandbox! Connect to ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/(ctf)-2024-realworldctf/" class="btn btn-outline-primary" prompt="Older"><p>(CTF) realworld CTF 2024 writeup (SafeBridge)</p></a> <a href="/posts/(ctf)-2024-SekaiCTF/" class="btn btn-outline-primary" prompt="Newer"><p>(CTF) SekaiCTF 2024 writeup (ZOO)</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/snwo_kr">snwo</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/web3/">web3</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-H9FVY2NFPZ"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-H9FVY2NFPZ'); }); </script>
